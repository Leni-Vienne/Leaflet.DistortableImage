{"version":3,"file":"leaflet.distortableimage.js","mappings":"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","sources":["webpack://leaflet-distortableimage/./src/DistortableCollection.js","webpack://leaflet-distortableimage/./src/DistortableImageOverlay.js","webpack://leaflet-distortableimage/./src/components/DistortableImage.Keymapper.js","webpack://leaflet-distortableimage/./src/edit/DistortableCollection.Edit.js","webpack://leaflet-distortableimage/./src/edit/DistortableImage.Edit.js","webpack://leaflet-distortableimage/./src/edit/actions/BorderAction.js","webpack://leaflet-distortableimage/./src/edit/actions/DeleteAction.js","webpack://leaflet-distortableimage/./src/edit/actions/DistortAction.js","webpack://leaflet-distortableimage/./src/edit/actions/DragAction.js","webpack://leaflet-distortableimage/./src/edit/actions/EditAction.js","webpack://leaflet-distortableimage/./src/edit/actions/ExportAction.js","webpack://leaflet-distortableimage/./src/edit/actions/FreeRotateAction.js","webpack://leaflet-distortableimage/./src/edit/actions/GeolocateAction.js","webpack://leaflet-distortableimage/./src/edit/actions/LockAction.js","webpack://leaflet-distortableimage/./src/edit/actions/OpacitiesAction.js","webpack://leaflet-distortableimage/./src/edit/actions/OpacityAction.js","webpack://leaflet-distortableimage/./src/edit/actions/ResizeRotateAction.js","webpack://leaflet-distortableimage/./src/edit/actions/RestoreAction.js","webpack://leaflet-distortableimage/./src/edit/actions/RotateAction.js","webpack://leaflet-distortableimage/./src/edit/actions/ScaleAction.js","webpack://leaflet-distortableimage/./src/edit/actions/StackAction.js","webpack://leaflet-distortableimage/./src/edit/actions/TransformAction.js","webpack://leaflet-distortableimage/./src/edit/actions/UnlockAction.js","webpack://leaflet-distortableimage/./src/edit/getEXIFdata.js","webpack://leaflet-distortableimage/./src/edit/handles/DistortHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/DragHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/EditHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/FreeRotateHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/LockHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/ResizeRotateHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/RotateHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/ScaleHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/TransformResizeHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/TransformRotateHandle.js","webpack://leaflet-distortableimage/./src/edit/handles/TransformSquishHandle.js","webpack://leaflet-distortableimage/./src/edit/toolbars/DistortableImage.ControlBar.js","webpack://leaflet-distortableimage/./src/edit/toolbars/DistortableImage.PopupBar.js","webpack://leaflet-distortableimage/./src/iconsets/IconSet.js","webpack://leaflet-distortableimage/./src/iconsets/KeymapperIconSet.js","webpack://leaflet-distortableimage/./src/iconsets/ToolbarIconSet.js","webpack://leaflet-distortableimage/./src/mapmixins/BoxCollector.js","webpack://leaflet-distortableimage/./src/mapmixins/DoubleClickLabels.js","webpack://leaflet-distortableimage/./src/mapmixins/DoubleClickZoom.js","webpack://leaflet-distortableimage/./src/mapmixins/MapMixins.js","webpack://leaflet-distortableimage/./src/util/DomUtil.js","webpack://leaflet-distortableimage/./src/util/IconUtil.js","webpack://leaflet-distortableimage/./src/util/ImageUtil.js","webpack://leaflet-distortableimage/./src/util/MatrixUtil.js","webpack://leaflet-distortableimage/./src/util/TrigUtil.js","webpack://leaflet-distortableimage/./src/util/Utils.js","webpack://leaflet-distortableimage/webpack/startup"],"sourcesContent":["const arr = [];\nL.DistortableCollection = L.FeatureGroup.extend({\n  options: {\n    editable: true,\n    exportOpts: {\n      exportStartUrl: '//export.mapknitter.org/export',\n      statusUrl: '//export.mapknitter.org',\n      exportUrl: 'http://export.mapknitter.org/',\n    },\n  },\n\n  initialize(options) {\n    L.setOptions(this, options);\n    L.FeatureGroup.prototype.initialize.call(this, options);\n    L.Utils.initTranslation.call(this);\n\n    this.editable = this.options.editable;\n  },\n\n  onAdd(map) {\n    L.FeatureGroup.prototype.onAdd.call(this, map);\n\n    this._map = map;\n\n    if (this.editable) { this.editing.enable(); }\n\n    /**\n     * although we have a DistortableCollection.Edit class that handles collection events to keep our code managable,\n     * events that need to be added on individual images are kept here to do so through `layeradd`.\n     */\n    this.on('layeradd', this._addEvents, this);\n    this.on('layerremove', this._removeEvents, this);\n  },\n\n  onRemove() {\n    if (this.editing) { this.editing.disable(); }\n    this.off('layeradd', this._addEvents, this);\n    this.off('layerremove', this._removeEvents, this);\n  },\n\n  _addEvents(e) {\n    const layer = e.layer;\n\n    L.DomEvent.on(layer, {\n      dragstart: this._dragStartMultiple,\n      drag: this._dragMultiple,\n    }, this);\n\n    L.DomEvent.on(layer.getElement(), {\n      mousedown: this._deselectOthers,\n      /* Enable longpress for multi select for touch devices. */\n      contextmenu: this._longPressMultiSelect,\n    }, this);\n  },\n\n  _removeEvents(e) {\n    const layer = e.layer;\n\n    L.DomEvent.off(layer, {\n      dragstart: this._dragStartMultiple,\n      drag: this._dragMultiple,\n    }, this);\n\n    L.DomEvent.off(layer.getElement(), {\n      mousedown: this._deselectOthers,\n      contextmenu: this._longPressMultiSelect,\n    }, this);\n  },\n\n  _longPressMultiSelect(e) {\n    if (!this.editable) { return; }\n\n    e.preventDefault();\n\n    this.eachLayer((layer) => {\n      const edit = layer.editing;\n      if (layer.getElement() === e.target && edit.enabled()) {\n        L.DomUtil.toggleClass(layer.getElement(), 'collected');\n        if (this.anyCollected()) {\n          layer.deselect();\n          this.editing._addToolbar();\n        } else {\n          this.editing._removeToolbar();\n        }\n      }\n    });\n  },\n\n  isCollected(overlay) {\n    return L.DomUtil.hasClass(overlay.getElement(), 'collected');\n  },\n\n  anyCollected() {\n    const layerArr = this.getLayers();\n    return layerArr.some(this.isCollected.bind(this));\n  },\n\n  _toggleCollected(e, layer) {\n    if (e.shiftKey) {\n      /* conditional prevents disabled images from flickering multi-select mode */\n      if (layer.editing.enabled()) {\n        L.DomUtil.toggleClass(e.target, 'collected');\n        // re-order layers by _leaflet_id to match their display order in UI\n        // add new layer to right position and avoid repitition\n        const newArr = arr.every((each) => {\n          return each._leaflet_id !== layer._leaflet_id;\n        });\n        if (newArr) {\n          arr.push(layer);\n        } else {\n          arr.splice(arr.indexOf(layer), 1);\n        }\n      }\n    }\n\n    if (this.anyCollected()) { layer.deselect(); }\n    else { this.editing._removeToolbar(); }\n  },\n\n  _deselectOthers(e) {\n    if (!this.editable) { return; }\n\n    this.eachLayer((layer) => {\n      if (layer.getElement() !== e.target) {\n        layer.deselect();\n      } else {\n        this._toggleCollected(e, layer);\n      }\n    });\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  _dragStartMultiple(e) {\n    const overlay = e.target;\n    const map = this._map;\n    let i;\n\n    if (!this.isCollected(overlay)) { return; }\n\n    this.eachLayer((layer) => {\n      layer._dragStartPoints = {};\n      layer.deselect();\n      for (i = 0; i < 4; i++) {\n        const c = layer.getCorner(i);\n        layer._dragStartPoints[i] = map.latLngToLayerPoint(c);\n      }\n    });\n  },\n\n  _dragMultiple(e) {\n    const overlay = e.target;\n    const map = this._map;\n\n    if (!this.isCollected(overlay)) { return; }\n\n    const topLeft = map.latLngToLayerPoint(overlay.getCorner(0));\n    const delta = overlay._dragStartPoints[0].subtract(topLeft);\n\n    this._updateCollectionFromPoints(delta, overlay);\n  },\n\n  _toRemove() {\n    const layerArr = this.getLayers();\n\n    return layerArr.filter((layer) => {\n      const mode = layer.editing._mode;\n      return (this.isCollected(layer) && mode !== 'lock');\n    });\n  },\n\n  _toMove(overlay) {\n    const layerArr = this.getLayers();\n\n    return layerArr.filter((layer) => {\n      const mode = layer.editing._mode;\n      return layer !== overlay && this.isCollected(layer) && mode !== 'lock';\n    });\n  },\n\n  _updateCollectionFromPoints(delta, overlay) {\n    const layersToMove = this._toMove(overlay);\n    const p = new L.Transformation(1, -delta.x, 1, -delta.y);\n    let i;\n\n    layersToMove.forEach((layer) => {\n      const movedPoints = {};\n      for (i = 0; i < 4; i++) {\n        movedPoints[i] = p.transform(layer._dragStartPoints[i]);\n      }\n      layer.setCornersFromPoints(movedPoints);\n    });\n  },\n\n  _getAvgCmPerPixel(imgs) {\n    const reduce = imgs.reduce(function(sum, img) {\n      return sum + img.cm_per_pixel;\n    }, 0);\n    return reduce / imgs.length;\n  },\n\n  // connects to JSON file and fetches JSON data therein from remote source\n  async fetchRemoteJson(url) {\n    let index = 0;\n    const imgCollectionProps = [];\n\n    try {\n      const response = await axios.get(url);\n      if (response.data.hasOwnProperty('avg_cm_per_pixel')) {\n        if (response.data.collection.length > 1) {\n          response.data.collection.forEach((data) => {\n            imgCollectionProps[index] = data;\n            index++;\n          });\n          return {\n            avg_cm_per_pixel: response.data.avg_cm_per_pixel,\n            imgCollectionProps,\n          };\n        }\n        imgCollectionProps[index] = response.data.collection;\n\n        return {\n          avg_cm_per_pixel: response.data.avg_cm_per_pixel,\n          imgCollectionProps,\n        };\n      } else {\n        if (response.data.length > 1) {\n          response.data.forEach((data) => {\n            imgCollectionProps[index] = data;\n            index++;\n          });\n          return {\n            imgCollectionProps,\n          };\n        }\n        imgCollectionProps[index] = response.data;\n\n        return {\n          imgCollectionProps,\n        };\n      }\n    } catch (err) {\n      console.log('err', err);\n    }\n  },\n\n  // expects url in this format: https://archive.org/download/mkl-1/mkl-1.json\n  async recreateImagesFromJsonUrl(url) {\n    let imageCollectionObj = {};\n\n    if (url) {\n      imageCollectionObj = await this.fetchRemoteJson(url);\n      return imageCollectionObj;\n    };\n\n    return imageCollectionObj;\n  },\n\n  generateExportJson(allImages = false) {\n    const json = {};\n    json.images = [];\n\n    this.eachLayer(function(layer) {\n      if (allImages || this.isCollected(layer)) {\n        const sections = layer._image.src.split('/');\n        const filename = sections[sections.length - 1];\n        const zc = layer.getCorners();\n\n        const corners = [\n          {lat: zc[0].lat, lon: zc[0].lng || zc[0].lon},\n          {lat: zc[1].lat, lon: zc[1].lng || zc[1].lon},\n          {lat: zc[3].lat, lon: zc[3].lng || zc[3].lon},\n          {lat: zc[2].lat, lon: zc[2].lng || zc[2].lon},\n        ];\n\n        json.images.push({\n          id: layer._leaflet_id,\n          src: layer._image.src,\n          width: layer._image.width,\n          height: layer._image.height,\n          tooltipText: layer.getTooltipText(),\n          image_file_name: filename,\n          nodes: corners,\n          cm_per_pixel: L.ImageUtil.getCmPerPixel(layer),\n        });\n      }\n    }, this);\n\n    json.images = json.images.reverse();\n    json.avg_cm_per_pixel = this._getAvgCmPerPixel(json.images);\n    return json;\n  },\n});\n\nL.distortableCollection = function(id, options) {\n  return new L.DistortableCollection(id, options);\n};\n","L.DistortableImageOverlay = L.ImageOverlay.extend({\n  options: {\n    height: 200,\n    crossOrigin: true,\n    // todo: find ideal number to prevent distortions during RotateScale, and make it dynamic (remove hardcoding)\n    edgeMinWidth: 50,\n    editable: true,\n    mode: 'resizeRotate', // Initial editing mode: 'drag', 'scale', 'distort', 'rotate', 'freeRotate', 'resizeRotate', 'transform', 'lock' (defaults to first available if not set)\n    selected: false,\n    interactive: true,\n    tooltipText: '',\n    deselectOnOutsideClick: true,\n    dragBehavior: 'overlay', // 'overlay', 'map', or 'auto'\n    selectOnDrag: true, // whether dragging should trigger selection\n    draggable: true, // whether the overlay can be dragged at all\n  },\n\n  initialize(url, options) {\n    L.setOptions(this, options);\n    L.Utils.initTranslation.call(this);\n\n    this.edgeMinWidth = this.options.edgeMinWidth;\n    this.editable = this.options.editable;\n    this._selected = this.options.selected;\n    this._url = url;\n    this.rotation = {};\n\n    this.interactive = this.options.interactive;\n    this.tooltipText = this.options.tooltipText;\n  },\n\n  onAdd(map) {\n    this._map = map;\n    console.log('[Debug] onAdd started. Element exists?', !!this.getElement());\n\n    if (!this.getElement()) {\n      this._initImage();\n      console.log('[Debug] _initImage called (src set).');\n    }\n\n    map.on('viewreset', this._reset, this);\n\n    if (this.options.corners) {\n      this._corners = this.options.corners;\n      if (map.options.zoomAnimation && L.Browser.any3d) {\n        map.on('zoomanim', this._animateZoom, this);\n      }\n    }\n\n    const element = this.getElement();\n    console.log('[Debug] Attaching load listener. Image complete?', element.complete, 'NaturalWidth:', element.naturalWidth);\n\n    // AI : Fix for cached images race condition\n    // Separate initialization logic to handle both 'load' event and immediate execution for cached images\n    const onImageLoad = () => {\n      console.log('[Debug] Load handler executing (via listener or immediate check)');\n      this.getPane().appendChild(this.getElement());\n      this._initImageDimensions();\n\n      if (this.options.rotation) {\n        const units = this.options.rotation.deg >= 0 ? 'deg' : 'rad';\n        this.setAngle(this.options.rotation[units], units);\n      } else {\n        this.rotation = {deg: 0, rad: 0};\n        this._reset();\n      }\n\n      /* Initialize default corners if not already set */\n      if (!this._corners) {\n        if (map.options.zoomAnimation && L.Browser.any3d) {\n          map.on('zoomanim', this._animateZoom, this);\n        }\n      }\n\n      /** if there is a featureGroup, only its editable option matters */\n      const eventParents = this._eventParents;\n      if (eventParents) {\n        this.eP = eventParents[Object.keys(eventParents)[0]];\n        if (this.eP.editable) {\n          this.editing.enable();\n        }\n      } else {\n        if (this.editable) {\n          this.editing.enable();\n        }\n        this.eP = null;\n      }\n    };\n\n    // Have to wait for the image to load because need to access its w/h\n    L.DomEvent.on(this.getElement(), 'load', onImageLoad);\n\n    // AI : Check if image is already loaded (from cache)\n    if (this.getElement().complete) {\n      console.log('[Debug] Image already complete. Triggering onImageLoad immediately.');\n      onImageLoad();\n    }\n\n    // Track mouse movement to distinguish clicks from drags\n    L.DomEvent.on(this.getElement(), 'mousedown', this._onMouseDown, this);\n    L.DomEvent.on(this.getElement(), 'click', this._onClick, this);\n    L.DomEvent.on(\n        map,\n        {\n          singleclickon: this._singleClickListeners,\n          singleclickoff: this._resetClickListeners,\n          singleclick: this._singleClick,\n        },\n        this,\n    );\n\n    /**\n     * custom events fired from DoubleClickLabels.js. Used to differentiate\n     * single / dblclick to not deselect images on map dblclick.\n     */\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.on(map, 'click', this.deselect, this);\n    }\n\n    this.fire('add');\n\n    L.DomEvent.on(this.getElement(), 'mousemove', this.activateTooltip, this);\n    L.DomEvent.on(this.getElement(), 'mouseout', this.closeTooltip, this);\n  },\n\n  onRemove(map) {\n    L.DomEvent.off(this.getElement(), 'click', this.select, this);\n    L.DomEvent.off(\n        map,\n        {\n          singleclickon: this._singleClickListeners,\n          singleclickoff: this._resetClickListeners,\n          singleclick: this._singleClick,\n        },\n        this,\n    );\n    L.DomEvent.off(map, 'click', this.deselect, this);\n\n    if (this.editing) {\n      this.editing.disable();\n    }\n    this.fire('remove');\n\n    L.ImageOverlay.prototype.onRemove.call(this, map);\n\n    L.DomEvent.on(this.getElement(), 'mouseout', this.closeTooltip, this);\n    L.DomEvent.off(\n        this.getElement(),\n        'mousemove',\n        this.deactivateTooltip,\n        this,\n    );\n  },\n\n  _initImageDimensions() {\n    const map = this._map;\n    const originalImageWidth = L.DomUtil.getStyle(this.getElement(), 'width');\n    const originalImageHeight = L.DomUtil.getStyle(this.getElement(), 'height');\n    const aspectRatio =\n      parseInt(originalImageWidth) / parseInt(originalImageHeight);\n    const imageHeight = this.options.height;\n    const imageWidth = parseInt(aspectRatio * imageHeight);\n    const center = map.project(map.getCenter());\n    const offset = L.point(imageWidth, imageHeight).divideBy(2);\n    if (this.options.corners) {\n      this._corners = this.options.corners;\n    } else {\n      this._corners = [\n        map.unproject(center.subtract(offset)),\n        map.unproject(center.add(L.point(offset.x, -offset.y))),\n        map.unproject(center.add(L.point(-offset.x, offset.y))),\n        map.unproject(center.add(offset)),\n      ];\n    }\n\n    this._initialDimensions = {\n      center: center,\n      offset: offset,\n      zoom: map.getZoom(),\n    };\n    this.setBounds(L.latLngBounds(this.getCorners()));\n  },\n\n  _singleClick(e) {\n    if (e.type === 'singleclick' && this.options.deselectOnOutsideClick) {\n      this.deselect();\n    } else {\n      return;\n    }\n  },\n\n  _onMouseDown(e) {\n    // Track initial mouse position to detect movement\n    this._mouseDownPos = {x: e.clientX, y: e.clientY};\n  },\n\n  _singleClickListeners() {\n    const map = this._map;\n    L.DomEvent.off(map, 'click', this.deselect, this);\n    L.DomEvent.on(map, 'singleclick', this.deselect, this);\n  },\n\n  _resetClickListeners() {\n    const map = this._map;\n    L.DomEvent.on(map, 'click', this.deselect, this);\n    L.DomEvent.off(map, 'singleclick', this.deselect, this);\n  },\n\n  isSelected() {\n    return this._selected;\n  },\n\n  deselect() {\n    const edit = this.editing;\n    if (!edit.enabled()) {\n      return;\n    }\n\n    // Set rebuild flag during deselection to prevent event firing issues\n    if (edit) {\n      edit._rebuildingToolbar = true;\n    }\n\n    try {\n      edit._removeToolbar();\n      edit._hideMarkers();\n\n      this._selected = false;\n      this.fire('deselect');\n    } finally {\n      // Clear rebuild flag\n      if (edit) {\n        edit._rebuildingToolbar = false;\n      }\n    }\n\n    return this;\n  },\n\n  _onClick(e) {\n    // Check if mouse moved significantly (indicates dragging/panning)\n    let wasMouseMovement = false;\n    if (this._mouseDownPos && !this.options.draggable) {\n      const moveDistance = Math.sqrt(\n          Math.pow(e.clientX - this._mouseDownPos.x, 2) +\n          Math.pow(e.clientY - this._mouseDownPos.y, 2),\n      );\n      wasMouseMovement = moveDistance > 5; // 5px threshold\n    }\n\n    // If draggable is false and there was mouse movement, ignore the click\n    // (user was panning the map through the overlay)\n    if (!this.options.draggable && wasMouseMovement) {\n      this._wasDragged = false;\n      return;\n    }\n    if (this._wasDragged) {\n      // This was a drag operation - use original selectOnDrag logic\n      if (this.options.selectOnDrag) {\n        this.select(e);\n      } else {\n        // selectOnDrag: false - only restore selection if already selected\n        if (this._selected) {\n          this.select(e); // Restore selection state (toolbar, etc.)\n        }\n      }\n    } else {\n      // This was a pure click (no drag) - toggle selection\n      if (this._selected) {\n        this.deselect();\n      } else {\n        this.select(e);\n      }\n    }\n    // Reset drag flag\n    this._wasDragged = false;\n  },\n\n  select(e) {\n    const edit = this.editing;\n    const eP = this.eP;\n\n    if (!edit.enabled()) {\n      return;\n    }\n    if (e) {\n      L.DomEvent.stopPropagation(e);\n    }\n\n    // this ensures deselection of all other images, allowing us to keep collection group optional\n    this._programmaticGrouping();\n\n    this._selected = true;\n    edit._addToolbar();\n    edit._showMarkers();\n    this.fire('select');\n\n    // we run the selection logic 1st anyway because the collection group's _addToolbar method depends on it\n    if (eP && eP.anyCollected()) {\n      this.deselect();\n      return;\n    }\n\n    return this;\n  },\n\n  _programmaticGrouping() {\n    this._map.eachLayer((layer) => {\n      if (layer instanceof L.DistortableImageOverlay) {\n        layer.deselect();\n      }\n    });\n  },\n\n  setCorner(corner, latlng) {\n    const edit = this.editing;\n\n    this._corners[corner] = latlng;\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  _cornerExceedsMapLats(zoom, corner, map) {\n    if (map.options.crs == L.CRS.Simple) {\n      return false;\n    } else {\n      let exceedsTop;\n      let exceedsBottom;\n      if (zoom === 0) {\n        exceedsTop = map.project(corner).y < 2;\n        exceedsBottom = map.project(corner).y >= 255;\n      } else {\n        exceedsTop = map.project(corner).y / zoom < 2;\n        exceedsBottom = map.project(corner).y / Math.pow(2, zoom) >= 255;\n      }\n      return exceedsTop || exceedsBottom;\n    }\n  },\n\n  activateTooltip() {\n    if (this.tooltipText && !this._selected) {\n      this.bindTooltip(this.tooltipText, {direction: 'top'}).openTooltip();\n    }\n  },\n\n  closeToolTip() {\n    this.closeTooltip();\n  },\n\n  deactivateTooltip() {\n    this.unbindTooltip();\n  },\n\n  getTooltipText() {\n    return this.tooltipText;\n  },\n\n  setCorners(latlngObj) {\n    const map = this._map;\n    const zoom = map.getZoom();\n    const edit = this.editing;\n    let i = 0;\n\n    // this is to fix https://github.com/publiclab/Leaflet.DistortableImage/issues/402\n    for (const k in latlngObj) {\n      if (this._cornerExceedsMapLats(zoom, latlngObj[k], map)) {\n        // calling reset / update w/ the same corners bc it prevents a marker flicker for rotate\n        this.setBounds(L.latLngBounds(this.getCorners()));\n        this.fire('update');\n        return;\n      }\n    }\n\n    for (const k in latlngObj) {\n      this._corners[i] = latlngObj[k];\n      i += 1;\n    }\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  setCornersFromPoints(pointsObj) {\n    const map = this._map;\n    const zoom = map.getZoom();\n    const edit = this.editing;\n    let i = 0;\n\n    for (const k in pointsObj) {\n      const corner = map.layerPointToLatLng(pointsObj[k]);\n\n      if (this._cornerExceedsMapLats(zoom, corner, map)) {\n        // calling reset / update w/ the same corners bc it prevents a marker flicker for rotate\n        this.setBounds(L.latLngBounds(this.getCorners()));\n        this.fire('update');\n        return;\n      }\n    }\n\n    for (const k in pointsObj) {\n      this._corners[i] = map.layerPointToLatLng(pointsObj[k]);\n      i += 1;\n    }\n\n    this.setBounds(L.latLngBounds(this.getCorners()));\n    this.fire('update');\n\n    if (edit.toolbar && edit.toolbar instanceof L.DistortableImage.PopupBar) {\n      edit._updateToolbarPos();\n    }\n\n    this.edited = true;\n\n    return this;\n  },\n\n  scaleBy(scale, anchor = null) {\n    const map = this._map;\n    const center = map.project(anchor || this.getCenter());\n    let i;\n    let p;\n    const scaledCorners = {};\n\n    if (scale === 0) {\n      return;\n    }\n\n    for (i = 0; i < 4; i++) {\n      p = map\n          .project(this.getCorner(i))\n          .subtract(center)\n          .multiplyBy(scale)\n          .add(center);\n      scaledCorners[i] = map.unproject(p);\n    }\n\n    this.setCorners(scaledCorners);\n\n    return this;\n  },\n\n  getAngle(unit = 'deg') {\n    const matrix = this.getElement()\n        .style[L.DomUtil.TRANSFORM].split('matrix3d')[1]\n        .slice(1, -1)\n        .split(',');\n\n    const row0x = matrix[0];\n    const row0y = matrix[1];\n    const row1x = matrix[4];\n    const row1y = matrix[5];\n\n    const determinant = row0x * row1y - row0y * row1x;\n\n    let angle = L.TrigUtil.calcAngle(row0x, row0y, 'rad');\n\n    if (determinant < 0) {\n      angle += angle < 0 ? Math.PI : -Math.PI;\n    }\n\n    if (angle < 0) {\n      angle = 2 * Math.PI + angle;\n    }\n\n    return unit === 'deg' ?\n      Math.round(L.TrigUtil.radiansToDegrees(angle)) :\n      L.Util.formatNum(angle, 2);\n  },\n\n  setAngle(angle, unit = 'deg') {\n    const currentAngle = this.getAngle(unit);\n    const angleToRotateBy = angle - currentAngle;\n    this.rotateBy(angleToRotateBy, unit);\n\n    return this;\n  },\n\n  rotateBy(angle, unit = 'deg', anchor = null) {\n    const map = this._map;\n    const center = map.project(anchor || this.getCenter());\n    const corners = {};\n    let i;\n    let p;\n    let q;\n\n    if (unit === 'deg') {\n      angle = L.TrigUtil.degreesToRadians(angle);\n    }\n\n    for (i = 0; i < 4; i++) {\n      p = map.project(this.getCorner(i)).subtract(center);\n      q = L.point(\n          Math.cos(angle) * p.x - Math.sin(angle) * p.y,\n          Math.sin(angle) * p.x + Math.cos(angle) * p.y,\n      );\n      corners[i] = map.unproject(q.add(center));\n    }\n\n    this.setCorners(corners);\n\n    return this;\n  },\n\n  dragBy(formerPoint, newPoint) {\n    const map = this._map;\n    let i;\n    let p;\n    const transCorners = {};\n    const delta = map.project(formerPoint).subtract(map.project(newPoint));\n\n    for (i = 0; i < 4; i++) {\n      p = map.project(this.getCorner(i)).subtract(delta);\n      transCorners[i] = map.unproject(p);\n    }\n\n    this.setCorners(transCorners);\n  },\n\n  restore() {\n    const map = this._map;\n    const center = this._initialDimensions.center;\n    const offset = this._initialDimensions.offset;\n    const zoom = this._initialDimensions.zoom;\n    const corners = [\n      center.subtract(offset),\n      center.add(L.point(offset.x, -offset.y)),\n      center.add(L.point(-offset.x, offset.y)),\n      center.add(offset),\n    ];\n\n    for (let i = 0; i < 4; i++) {\n      if (!map.unproject(corners[i], zoom).equals(this.getCorner(i))) {\n        this.setCorner(i, map.unproject(corners[i], zoom));\n      }\n    }\n\n    this.edited = false;\n    this.fire('restore');\n\n    return this;\n  },\n\n  /* Copied from Leaflet v0.7 https://github.com/Leaflet/Leaflet/blob/66282f14bcb180ec87d9818d9f3c9f75afd01b30/src/dom/DomUtil.js#L189-L199 */\n  /* since L.DomUtil.getTranslateString() is deprecated in Leaflet v1.0 */\n  _getTranslateString(point) {\n    // on WebKit browsers (Chrome/Safari/iOS Safari/Android)\n    // using translate3d instead of translate\n    // makes animation smoother as it ensures HW accel is used.\n    // Firefox 13 doesn't care\n    // (same speed either way), Opera 12 doesn't support translate3d\n\n    const is3d = L.Browser.webkit3d;\n    const open = 'translate' + (is3d ? '3d' : '') + '(';\n    const close = (is3d ? ',0' : '') + ')';\n\n    return open + point.x + 'px,' + point.y + 'px' + close;\n  },\n\n  _reset() {\n    const map = this._map;\n    const image = this.getElement();\n    const latLngToLayerPoint = L.bind(map.latLngToLayerPoint, map);\n    const transformMatrix =\n      this._calculateProjectiveTransform(latLngToLayerPoint);\n    const topLeft = latLngToLayerPoint(this.getCorner(0));\n    const warp = L.DomUtil.getMatrixString(transformMatrix);\n    const translation = this._getTranslateString(topLeft);\n\n    /* See L.DomUtil.setPosition. Mainly for the purposes of L.Draggable. */\n    image._leaflet_pos = topLeft;\n\n    image.style[L.DomUtil.TRANSFORM] = [translation, warp].join(' ');\n\n    /* Set origin to the upper-left corner rather than\n     * the center of the image, which is the default.\n     */\n    image.style[L.DomUtil.TRANSFORM + '-origin'] = '0 0 0';\n\n    this.rotation.deg = this.getAngle();\n    this.rotation.rad = this.getAngle('rad');\n  },\n\n  /*\n   * Calculates the transform string that will be\n   * correct *at the end* of zooming.\n   * Leaflet then generates a CSS3 animation between the current transform and\n   * future transform which makes the transition appear smooth.\n   */\n  _animateZoom(event) {\n    const map = this._map;\n    const image = this.getElement();\n    const latLngToNewLayerPoint = function(latlng) {\n      return map._latLngToNewLayerPoint(latlng, event.zoom, event.center);\n    };\n    const transformMatrix = this._calculateProjectiveTransform(\n        latLngToNewLayerPoint,\n    );\n    const topLeft = latLngToNewLayerPoint(this.getCorner(0));\n    const warp = L.DomUtil.getMatrixString(transformMatrix);\n    const translation = this._getTranslateString(topLeft);\n\n    /* See L.DomUtil.setPosition. Mainly for the purposes of L.Draggable. */\n    image._leaflet_pos = topLeft;\n\n    image.style[L.DomUtil.TRANSFORM] = [translation, warp].join(' ');\n  },\n\n  getCorners() {\n    return this._corners;\n  },\n\n  getCorner(i) {\n    if (i >= 0) {\n      return this._corners[i];\n    } else if (i === -5) {\n      const map = this._map;\n      const pointA = map.project(this._corners[2]);\n      const pointB = map.project(this._corners[3]).subtract(pointA);\n      const half = Math.sqrt(Math.pow(pointB.x, 2) + Math.pow(pointB.y, 2)) / 2;\n      const deviation = 32;\n      const angle =\n        Math.atan(deviation / half) + Math.atan2(pointB.y, pointB.x);\n      const length = Math.sqrt(Math.pow(half, 2) + Math.pow(deviation, 2));\n      const point = L.point(\n          Math.cos(angle) * length,\n          Math.sin(angle) * length,\n      ).add(pointA);\n      return map.unproject(point);\n    } else {\n      const aCorner = Math.abs(i) % 4;\n      const bCorner =\n        aCorner === 1 ? 0 : aCorner === 2 ? 3 : aCorner === 3 ? 1 : 2;\n      const lat = (this._corners[aCorner].lat + this._corners[bCorner].lat) / 2;\n      const lng = (this._corners[aCorner].lng + this._corners[bCorner].lng) / 2;\n      return L.latLng(lat, lng);\n    }\n  },\n\n  getOppositeCorner(i) {\n    return i === 0 ?\n      this.getCorner(3) :\n      i === 1 ?\n        this.getCorner(2) :\n        i === 2 ?\n          this.getCorner(1) :\n          i === 3 ?\n            this.getCorner(0) :\n            i === -1 ?\n              this.getCorner(-2) :\n              i === -2 ?\n                this.getCorner(-1) :\n                i === -3 ?\n                  this.getCorner(-4) :\n                  i === -4 ?\n                    this.getCorner(-3) :\n                    null;\n  },\n\n  setOptions(newOptions) {\n    if (!newOptions) return this;\n\n    const oldOptions = L.Util.extend({}, this.options);\n    L.setOptions(this, newOptions);\n\n    // Handle specific property updates that require special logic\n    this._updateProperties(oldOptions, newOptions);\n\n    return this;\n  },\n\n  _updateProperties(oldOptions, newOptions) {\n    // Update instance properties that are cached from options\n    if ('editable' in newOptions) {\n      this.editable = this.options.editable;\n      // Handle editing state changes\n      if (this._map && this.editing) {\n        if (this.options.editable && !this.editing.enabled()) {\n          this.editing.enable();\n        } else if (!this.options.editable && this.editing.enabled()) {\n          this.editing.disable();\n        }\n      }\n    }\n\n    if ('interactive' in newOptions) {\n      this.interactive = this.options.interactive;\n    }\n\n    if ('tooltipText' in newOptions) {\n      this.tooltipText = this.options.tooltipText;\n      // Update tooltip if currently displayed\n      if (this.isTooltipOpen()) {\n        this.closeTooltip();\n        if (this.tooltipText) {\n          this.bindTooltip(this.tooltipText, {direction: 'top'});\n        }\n      }\n    }\n\n    if ('selected' in newOptions) {\n      this._selected = this.options.selected;\n      // Apply selection state if overlay is on map\n      if (this._map) {\n        if (this.options.selected && !this.isSelected()) {\n          this.select();\n        } else if (!this.options.selected && this.isSelected()) {\n          this.deselect();\n        }\n      }\n    }\n\n    if ('mode' in newOptions && this.editing && this.editing.enabled()) {\n      // Update editing mode if it's available\n      if (this.editing.hasMode(this.options.mode)) {\n        this.editing.setMode(this.options.mode);\n      }\n    }\n\n    if ('height' in newOptions && this._map) {\n      // Recalculate dimensions if height changed\n      this._initImageDimensions();\n    }\n\n    if ('edgeMinWidth' in newOptions) {\n      this.edgeMinWidth = this.options.edgeMinWidth;\n    }\n\n    // Handle actions/tools changes\n    if ('actions' in newOptions && this.editing && this.editing.enabled()) {\n      // Set rebuild flag to prevent event firing during toolbar rebuild\n      if (this.editing) {\n        this.editing._rebuildingToolbar = true;\n      }\n      try {\n        this.editing.setActions(this.options.actions);\n      } finally {\n        // Clear rebuild flag\n        if (this.editing) {\n          this.editing._rebuildingToolbar = false;\n        }\n      }\n    }\n\n    // Handle drag behavior properties - these affect event handling and editing behavior\n    if (\n      'dragBehavior' in newOptions ||\n      'selectOnDrag' in newOptions ||\n      'draggable' in newOptions\n    ) {\n      // If editing is enabled, update the drag behavior\n      if (this.editing && this.editing.enabled()) {\n        // Trigger a refresh of the editing handlers to apply new drag behavior\n        this.editing._refreshHandlers();\n      }\n    }\n\n    // Fire an event to notify that options have changed\n    // This is safe because fire() now has null checks\n    this.fire('optionschanged', {\n      oldOptions: oldOptions,\n      newOptions: newOptions,\n    });\n  },\n\n  /**\n   * Override fire() method to add null safety checks.\n   * Prevents errors when events are fired during state transitions (e.g., toolbar rebuilds)\n   * where this._map might be null or in an invalid state.\n   */\n  fire(type, data, propagate) {\n    // Add null safety check - don't fire events if map is null or transitional\n    if (!this._map || (this.editing && this.editing._rebuildingToolbar)) {\n      return this;\n    }\n\n    // Call parent fire method with null safety\n    try {\n      return L.ImageOverlay.prototype.fire.call(this, type, data, propagate);\n    } catch (error) {\n      // Silently handle errors during event firing to prevent crashes\n      // during state transitions\n      if (console && console.warn) {\n        console.warn('Event firing failed during state transition:', error);\n      }\n      return this;\n    }\n  },\n\n  // image (vertex) centroid calculation\n  getCenter() {\n    const map = this._map;\n    const reduce = this.getCorners().reduce(\n        function(agg, corner) {\n          return agg.add(map.project(corner));\n        },\n        L.point(0, 0),\n    );\n    return map.unproject(reduce.divideBy(4));\n  },\n\n  _calculateProjectiveTransform(latLngToCartesian) {\n    /* Setting reasonable but made-up image defaults\n     * allow us to place images on the map before\n     * they've finished downloading. */\n    const offset = latLngToCartesian(this.getCorner(0));\n    const w = this.getElement().offsetWidth || 500;\n    const h = this.getElement().offsetHeight || 375;\n    const c = [];\n    let j;\n    /* Convert corners to container points (i.e. cartesian coordinates). */\n    for (j = 0; j < 4; j++) {\n      c.push(latLngToCartesian(this.getCorner(j))._subtract(offset));\n    }\n\n    /*\n     * This matrix describes the action of\n     * the CSS transform on each corner of the image.\n     * It maps from the coordinate system centered\n     * at the upper left corner of the image\n     * to the region bounded by the latlngs in this._corners.\n     * For example:\n     * 0, 0, c[0].x, c[0].y\n     * says that the upper-left corner of the image\n     * maps to the first latlng in this._corners.\n     */\n    return L.MatrixUtil.general2DProjection(\n        0,\n        0,\n        c[0].x,\n        c[0].y,\n        w,\n        0,\n        c[1].x,\n        c[1].y,\n        0,\n        h,\n        c[2].x,\n        c[2].y,\n        w,\n        h,\n        c[3].x,\n        c[3].y,\n    );\n  },\n});\n\nL.distortableImageOverlay = function(id, options) {\n  return new L.DistortableImageOverlay(id, options);\n};\n\nL.Map.addInitHook(function() {\n  if (!L.DomUtil.hasClass(this.getContainer(), 'ldi')) {\n    L.DomUtil.addClass(this.getContainer(), 'ldi');\n  }\n});\n","L.DomUtil = L.DomUtil || {};\nL.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.Keymapper = L.Handler.extend({\n\n  options: {\n    position: 'topright',\n  },\n\n  initialize(map, options) {\n    this._map = map;\n    L.setOptions(this, options);\n  },\n\n  addHooks() {\n    if (!this._keymapper) {\n      this._container = this._buildContainer();\n      this._scrollWrapper = this._wrap();\n      this._toggler = this._createButton();\n      this._setMapper(this._container, this._scrollWrapper, this._toggler);\n\n      L.DomEvent.on(this._toggler, 'click', this._toggleKeymapper, this);\n\n      L.DomEvent.disableClickPropagation(this._container);\n      L.DomEvent.disableScrollPropagation(this._container);\n    }\n  },\n\n  removeHooks() {\n    if (this._keymapper) {\n      L.DomEvent.off(this._toggler, 'click', this._toggleKeymapper, this);\n\n      L.DomUtil.remove(this._toggler);\n      L.DomUtil.remove(this._scrollWrapper);\n      L.DomUtil.remove(this._container);\n      this._keymapper = false;\n    }\n  },\n\n  _buildContainer() {\n    const container = L.DomUtil.create('div', 'ldi-keymapper-hide');\n    container.setAttribute('id', 'ldi-keymapper');\n\n    const divider = L.DomUtil.create('br', 'divider');\n    container.appendChild(divider);\n\n    return container;\n  },\n\n  _createButton() {\n    const toggler = L.DomUtil.create('a', '');\n    toggler.innerHTML = L.IconUtil.create('keyboard_open');\n\n    toggler.setAttribute('id', 'toggle-keymapper');\n    toggler.setAttribute('href', '#');\n    toggler.setAttribute('title', 'Show keymap');\n    // Will force screen readers like VoiceOver to read this as \"Show keymap - button\"\n    toggler.setAttribute('role', 'button');\n    toggler.setAttribute('aria-label', 'Show keymap');\n\n    return toggler;\n  },\n\n  _wrap() {\n    const wrap = L.DomUtil.create('div', '');\n    wrap.setAttribute('id', 'keymapper-wrapper');\n    wrap.style.display = 'none';\n\n    return wrap;\n  },\n\n  _setMapper(container, wrap, button) {\n    this._keymapper = L.control({position: this.options.position});\n\n    this._keymapper.onAdd = function() {\n      container.appendChild(wrap);\n      wrap.insertAdjacentHTML(\n          'beforeend',\n          '<table><tbody>' +\n          '<hr id=\"keymapper-hr\">' +\n          /* eslint-disable */\n          '<tr><td><div class=\"left\"><span>Rotate Mode</span></div><div class=\"right\"><kbd>R</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>RotateScale Mode</span></div><div class=\"right\"><kbd>r</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Scale Mode</span></div><div class=\"right\"><kbd>s</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Distort Mode</span></div><div class=\"right\"><kbd>d</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Drag Mode</span></div><div class=\"right\"><kbd>D</kbd></div></td></tr>' +   \n          '<tr><td><div class=\"left\"><span>Lock (Mode) / Unlock Image</span></div><div class=\"right\"><kbd>l</kbd>\\xa0<kbd>u</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Stack up / down</span></div><div class=\"right\"><kbd>q</kbd>\\xa0<kbd>a</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Add / Remove Image Border</span></div><div class=\"right\"><kbd>b</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Toggle Opacity</span></div><div class=\"right\"><kbd>o</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Deselect All</span></div><div class=\"right\"><kbd>esc</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Delete Image(s)</span></div><div class=\"right\"><kbd>delete</kbd>\\xa0<kbd>backspace</kbd></div></td></tr>' +\n          '<tr><td><div class=\"left\"><span>Export Image(s)</span></div><div class=\"right\"><kbd>e</kbd></div></td></tr>' +\n          '</tbody></table>'\n      );\n      /* eslint-enable */\n      container.appendChild(button);\n      return container;\n    };\n\n    this._keymapper.addTo(this._map);\n  },\n\n  _toggleKeymapper(e) {\n    e.preventDefault();\n\n    this._container.className = (\n      this._container.className === 'ldi-keymapper leaflet-control' ?\n        'ldi-keymapper-hide leaflet-control' :\n        'ldi-keymapper leaflet-control'\n    );\n\n    this._scrollWrapper.style.display = (\n      this._scrollWrapper.style.display === 'none' ? 'block' : 'none'\n    );\n\n    this._toggler.innerHTML = (\n      this._toggler.innerHTML === 'close' ?\n        L.IconUtil.create('keyboard_open') :\n        'close'\n    );\n\n    L.IconUtil.toggleTitle(this._toggler, 'Show keymap', 'Hide keymap');\n    L.DomUtil.toggleClass(this._toggler, 'close-icon');\n  },\n\n  _injectIconSet() {\n    if (document.querySelector('#keymapper-iconset')) { return; }\n\n    const el = L.DomUtil.create('div', '');\n    el.id = 'keymapper-iconset';\n    el.setAttribute('hidden', 'hidden');\n\n    this._iconset = new L.KeymapperIconSet().render();\n    el.innerHTML = this._iconset;\n\n    document.querySelector('.leaflet-control-container').appendChild(el);\n  },\n});\n\nL.DistortableImage.Keymapper.addInitHook(() => {\n  L.DistortableImage.Keymapper.prototype._n = (\n    L.DistortableImage.Keymapper.prototype._n ?\n    L.DistortableImage.Keymapper.prototype._n + 1 :\n    1\n  );\n  // dont enable keymapper for mobile\n  if (L.DistortableImage.Keymapper.prototype._n === 1 && !L.Browser.mobile) {\n    this.enable();\n    this._injectIconSet();\n  }\n});\n\nL.distortableImage.keymapper = (map, options) => {\n  return new L.DistortableImage.Keymapper(map, options);\n};\n","L.DistortableImage = L.DistortableImage || {};\n\n// this class holds the keybindings and toolbar API for an image collection instance\nL.DistortableCollection.Edit = L.Handler.extend({\n  options: {\n    keymap: L.distortableImage.group_action_map,\n  },\n\n  initialize(group, options) {\n    this._group = group;\n    this._exportOpts = group.options.exportOpts;\n\n    L.setOptions(this, options);\n\n    L.distortableImage.group_action_map.Escape = '_decollectAll';\n  },\n\n  addHooks() {\n    const group = this._group;\n    const map = group._map;\n\n    this.editActions = this.options.actions;\n    this.runExporter =\n        L.bind(L.Utils.getNestedVal(this, '_exportOpts', 'exporter') ||\n        this.startExport, this);\n\n    L.DomEvent.on(document, 'keydown', this._onKeyDown, this);\n\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.on(map, 'click', this._decollectAll, this);\n    }\n\n    L.DomEvent.on(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n      boxcollectend: this._addCollections,\n    }, this);\n\n    this._group.editable = true;\n    this._group.eachLayer(layer => layer.editing.enable());\n  },\n\n  removeHooks() {\n    const group = this._group;\n    const map = group._map;\n\n    L.DomEvent.off(document, 'keydown', this._onKeyDown, this);\n\n    if (!(map.doubleClickZoom.enabled() || map.doubleClickLabels.enabled())) {\n      L.DomEvent.off(map, 'click', this._decollectAll, this);\n    }\n\n    L.DomEvent.off(map, {\n      singleclickon: this._singleClickListeners,\n      singleclickoff: this._resetClickListeners,\n      singleclick: this._singleClick,\n      boxcollectend: this._addCollections,\n    }, this);\n\n    this._decollectAll();\n    this._group.editable = false;\n    this._group.eachLayer(layer => layer.editing.disable());\n  },\n\n  enable() {\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable() {\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _onKeyDown(e) {\n    const keymap = this.options.keymap;\n    const handlerName = keymap[e.key];\n\n    if (!this[handlerName]) { return; }\n\n    if (this._group.anyCollected()) {\n      this[handlerName].call(this);\n    }\n  },\n\n  _singleClick(e) {\n    if (e.type === 'singleclick') { this._decollectAll(e); }\n    else { return; }\n  },\n\n  _singleClickListeners() {\n    const map = this._group._map;\n    L.DomEvent.off(map, 'click', this._decollectAll, this);\n    L.DomEvent.on(map, 'singleclick', this._decollectAll, this);\n  },\n\n  _resetClickListeners() {\n    const map = this._group._map;\n    L.DomEvent.on(map, 'click', this._decollectAll, this);\n    L.DomEvent.off(map, 'singleclick', this._decollectAll, this);\n  },\n\n  _decollectAll(e) {\n    let oe;\n\n    if (e) { oe = e.originalEvent; }\n    /**\n     * prevents image deselection following the 'boxcollectend' event - note 'shift' must not be released until dragging is complete\n     * also prevents deselection following a click on a disabled img by differentiating it from the map\n     */\n    if (oe && (oe.shiftKey || oe.target instanceof HTMLImageElement)) {\n      return;\n    }\n\n    this._group.eachLayer((layer) => {\n      L.DomUtil.removeClass(layer.getElement(), 'collected');\n      layer.deselect();\n    });\n\n    this._removeToolbar();\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  _unlockGroup() {\n    if (!this.hasTool(L.UnlockAction)) { return; }\n\n    this._group.eachLayer((layer) => {\n      if (this._group.isCollected(layer)) {\n        const edit = layer.editing;\n        edit._unlock();\n        // unlock updates the layer's handles; deselect to ensure they're hidden\n        layer.deselect();\n      }\n    });\n  },\n\n  _lockGroup() {\n    if (!this.hasTool(L.LockAction)) { return; }\n\n    this._group.eachLayer((layer) => {\n      if (this._group.isCollected(layer) ) {\n        const edit = layer.editing;\n        edit._lock();\n        // map.addLayer also deselects the image, so we reselect here\n        L.DomUtil.addClass(layer.getElement(), 'collected');\n      }\n    });\n  },\n\n  _addCollections(e) {\n    const box = e.boxCollectBounds;\n    const map = this._group._map;\n\n    this._group.eachLayer((layer) => {\n      const edit = layer.editing;\n\n      if (layer.isSelected()) { layer.deselect(); }\n\n      const zoom = map.getZoom();\n      const center = map.getCenter();\n      let imgBounds = L.latLngBounds(layer.getCorner(2), layer.getCorner(1));\n\n      imgBounds = map._latLngBoundsToNewLayerBounds(imgBounds, zoom, center);\n      if (box.intersects(imgBounds) && edit.enabled()) {\n        if (!this.toolbar) { this._addToolbar(); }\n        L.DomUtil.addClass(layer.getElement(), 'collected');\n      }\n    });\n  },\n\n  _removeGroup(e) {\n    if (!this.hasTool(L.DeleteAction)) { return; }\n\n    const layersToRemove = this._group._toRemove();\n    const n = layersToRemove.length;\n\n    if (n === 0) { return; }\n\n    const choice = L.DomUtil.confirmDeletes(n);\n\n    if (choice) {\n      layersToRemove.forEach((layer) => {\n        this._group.removeLayer(layer);\n      });\n      if (!this._group.anyCollected()) {\n        this._removeToolbar();\n      }\n    }\n\n    if (e) { L.DomEvent.stopPropagation(e); }\n  },\n\n  cancelExport() {\n    if (!this.customCollection) {\n      this._exportOpts.collection = undefined;\n    }\n\n    clearInterval(this.updateInterval);\n  },\n\n  _addToolbar() {\n    const group = this._group;\n    const map = group._map;\n\n    if (group.options.suppressToolbar || this.toolbar) { return; }\n    this.toolbar = L.distortableImage.controlBar({\n      actions: this.editActions,\n      position: 'topleft',\n    }).addTo(map, group);\n  },\n\n  _removeToolbar() {\n    const map = this._group._map;\n    if (this.toolbar) {\n      map.removeLayer(this.toolbar);\n      this.toolbar = false;\n    } else {\n      return false;\n    }\n  },\n\n  hasTool(value) {\n    return this.editActions.some(action => action === value);\n  },\n\n  addTool(value) {\n    if (value.baseClass === 'leaflet-toolbar-icon' && !this.hasTool(value)) {\n      this._removeToolbar();\n      this.editActions.push(value);\n      this._addToolbar();\n    }\n    return this;\n  },\n\n  removeTool(value) {\n    this.editActions.some((item, idx) => {\n      if (this.editActions[idx] === value) {\n        this._removeToolbar();\n        this.editActions.splice(idx, 1);\n        this._addToolbar();\n        return true;\n      } else {\n        return false;\n      }\n    });\n    return this;\n  },\n\n  startExport() {\n    if (!this.hasTool(L.ExportAction)) { return; }\n\n    return new Promise((resolve) => {\n      const opts = this._exportOpts;\n      opts.resolve = resolve; // allow resolving promise in user-defined functions, to stop spinner on completion\n\n      let statusUrl;\n      this.updateInterval = null;\n\n      // this may be overridden to update the UI to show export progress or completion\n      const _defaultUpdater = (data) => {\n        data = JSON.parse(data);\n        // optimization: fetch status directly from google storage:\n        if (data.status_url) {\n          if (statusUrl !== data.status_url && data.status_url.match('.json')) {\n            // if (data.status_url && data.status_url.substr(0,1) === \"/\") {\n            //   opts.statusUrl = opts.statusUrl + data.status_url;\n            // } else {\n            statusUrl = data.status_url;\n            // }\n          }\n\n          if (data.status === 'complete') {\n            clearInterval(this.updateInterval);\n\n            if (!this.customCollection) {\n              this._exportOpts.collection = undefined;\n            }\n\n            resolve();\n            if (data.jpg !== null) {\n              alert('Export succeeded. ' + opts.exportUrl + data.jpg);\n            }\n          }\n\n          // TODO: update to clearInterval when status == \"failed\" if we update that in this file:\n          // https://github.com/publiclab/mapknitter-exporter/blob/main/lib/mapknitterExporter.rb\n          console.log(data);\n        }\n      };\n\n      // receives the URL of status.json, and starts running the updater to repeatedly fetch from status.json;\n      // this may be overridden to integrate with any UI\n      const _defaultHandleStatusRes = (data) => {\n        statusUrl = opts.statusUrl + data;\n        // repeatedly fetch the status.json\n        this.updateInterval = setInterval(() => {\n          const reqOpts = {method: 'GET'};\n          const req = new Request(`${statusUrl}?${Date.now()}`, reqOpts);\n          fetch(req).then((res) => {\n            if (res.ok) {\n              return res.text();\n            }\n          }).then(opts.updater);\n        }, opts.frequency);\n      };\n\n      // initiate the export\n      const _defaultFetchStatusUrl = (mergedOpts) => {\n        const form = new FormData();\n        form.append('collection', JSON.stringify(mergedOpts.collection));\n        form.append('scale', mergedOpts.scale);\n        form.append('upload', true);\n\n        const reqOpts = {method: 'POST', body: form};\n        const req = new Request(mergedOpts.exportStartUrl, reqOpts);\n        fetch(req).then((res) => {\n          if (res.ok) {\n            return res.text();\n          }\n        }).then(mergedOpts.handleStatusRes);\n      };\n\n      // If the user has passed collection property\n      this.customCollection = !!opts.collection;\n      if (!this.customCollection) {\n        opts.collection = this._group.generateExportJson().images;\n      }\n\n      opts.frequency = opts.frequency || 3000;\n      opts.scale = opts.scale || 100; // switch it to _getAvgCmPerPixel !\n      opts.updater = opts.updater || _defaultUpdater;\n      opts.handleStatusRes = opts.handleStatusRes || _defaultHandleStatusRes;\n      opts.fetchStatusUrl = opts.fetchStatusUrl || _defaultFetchStatusUrl;\n\n      opts.fetchStatusUrl(opts);\n    });\n  },\n});\n\nL.distortableCollection.edit = (group, options) => {\n  return new L.DistortableCollection.Edit(group, options);\n};\n","L.DistortableImage = L.DistortableImage || {};\n\n// holds the keybindings & toolbar API for an individual image instance\nL.DistortableImage.Edit = L.Handler.extend({\n  options: {\n    opacity: 0.5,\n    outline: '1px solid red',\n    keymap: L.distortableImage.action_map,\n  },\n\n  initialize(overlay, options) {\n    this._overlay = overlay;\n    this._toggledImage = false;\n    this._mode = overlay.options.mode;\n    this._transparent = false;\n    this._outlined = false;\n    this._opacity = options.opacity;\n\n    L.setOptions(this, options);\n\n    L.distortableImage.action_map.Escape = '_deselect';\n  },\n\n  /* Run on image selection. */\n  addHooks() {\n    const overlay = this._overlay;\n\n    this.editActions = this.options.actions;\n\n    /* bring the selected image into view */\n    overlay.bringToFront();\n    this._initModes();\n    this._initHandles();\n    this._appendHandlesandDragable();\n\n    if (overlay.isSelected() && !overlay.options.suppressToolbar) {\n      this._addToolbar();\n    }\n\n    this.parentGroup = overlay.eP ? overlay.eP : false;\n\n    // Double-click to change mode removed for better UX\n\n    L.DomEvent.on(window, 'keydown', this._onKeyDown, this);\n  },\n\n  /* Run on image deselection. */\n  removeHooks() {\n    const overlay = this._overlay;\n    const eP = this.parentGroup;\n\n    // First, check if dragging exists - it may be off due to locking\n    this._disableDragging();\n\n    if (this.toolbar) { this._removeToolbar(); }\n\n    for (const handle in this._handles) {\n      L.DomUtil.remove(handle);\n    }\n\n    /**\n     * ensures if you disable an image while it is multi-selected\n     * additional deselection logic is run\n     */\n    if (L.DomUtil.hasClass(overlay.getElement(), 'collected')) {\n      L.DomUtil.removeClass(overlay.getElement(), 'collected');\n    }\n\n    if (eP && (!eP.anyCollected() && eP.editing.toolbar)) {\n      eP.editing._removeToolbar();\n    }\n\n    // Double-click event handler removed\n\n    L.DomEvent.off(window, 'keydown', this._onKeyDown, this);\n  },\n\n  disable() {\n    if (!this._enabled) { return this; }\n\n    this._overlay.deselect();\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _initModes() {\n    this._modes = {};\n    // passed from L.DistortablImage.PopupBar. If the mode is one\n    // of the current toolbar actions, adds it to this._modes\n    for (const mode in L.DistortableImage.Edit.MODES) {\n      const action = L.DistortableImage.Edit.MODES[mode];\n      if (this.editActions.indexOf(action) !== -1) {\n        this._modes[mode] = action;\n      }\n    }\n\n    // sets the current mode to the 1st available one if the one selected\n    // during initialization is not available\n    if (!this._modes[this._mode]) {\n      this._mode = Object.keys(this._modes)[0];\n    }\n  },\n\n\n  _initHandles() {\n    const overlay = this._overlay;\n    let i;\n\n    this._dragHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._dragHandles.addLayer(L.dragHandle(overlay, i));\n    }\n\n    this._scaleHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._scaleHandles.addLayer(L.scaleHandle(overlay, i));\n    }\n\n    this._distortHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._distortHandles.addLayer(L.distortHandle(overlay, i));\n    }\n\n    this._rotateHandles = L.layerGroup(); // individual rotate\n    for (i = 0; i < 4; i++) {\n      this._rotateHandles.addLayer(L.rotateHandle(overlay, i));\n    }\n\n    // handle includes rotate AND scale\n    this._freeRotateHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._freeRotateHandles.addLayer(L.freeRotateHandle(overlay, i));\n    }\n\n    this._resizeRotateHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._resizeRotateHandles.addLayer(L.resizeRotateHandle(overlay, i));\n    }\n\n    this._transformHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._transformHandles.addLayer(L.transformResizeHandle(overlay, i));\n    }\n    for (i = -1; i >= -4; i--) {\n      this._transformHandles.addLayer(L.transformSquishHandle(overlay, i));\n    }\n    this._transformHandles.addLayer(L.transformRotateHandle(overlay, -5));\n\n    this._lockHandles = L.layerGroup();\n    for (i = 0; i < 4; i++) {\n      this._lockHandles.addLayer(L.lockHandle(overlay, i, {draggable: false}));\n    }\n\n    this._handles = {\n      drag: this._dragHandles,\n      scale: this._scaleHandles,\n      distort: this._distortHandles,\n      rotate: this._rotateHandles,\n      freeRotate: this._freeRotateHandles,\n      resizeRotate: this._resizeRotateHandles,\n      transform: this._transformHandles,\n      lock: this._lockHandles,\n    };\n  },\n\n  _appendHandlesandDragable() {\n    const ov = this._overlay;\n\n    // won't throw error if user adds 0 mode actions to toolbar\n    if (!this._mode) {\n      this._enableDragging();\n      return;\n    }\n\n    this._updateHandle();\n\n    if (!ov.isSelected() && this.currentHandle) {\n      this.currentHandle.eachLayer((handle) => {\n        handle.setOpacity(0);\n        if (handle.dragging) { handle.dragging.disable(); }\n      });\n    }\n    if (!this.isMode('lock')) { this._enableDragging(); }\n  },\n\n  _onKeyDown(e) {\n    const keymap = this.options.keymap;\n    const handlerName = keymap[e.key];\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n\n    if (eP && eP.anyCollected()) { return; }\n\n    if (this[handlerName] !== undefined && !ov.options.suppressToolbar) {\n      if (ov.isSelected() && this.toolbar) {\n        this[handlerName].call(this);\n      }\n    }\n  },\n\n  replaceTool(old, next) {\n    if (next.baseClass !== 'leaflet-toolbar-icon' || this.hasTool(next)) {\n      return this;\n    }\n\n    // Set rebuild flag during tool replacement\n    this._rebuildingToolbar = true;\n\n    try {\n      this.editActions.some((item, idx) => {\n        if (item === old) {\n          this._removeToolbar();\n          this.editActions[idx] = next;\n          this._addToolbar();\n          for (const mode in L.DistortableImage.Edit.MODES) {\n            if (L.DistortableImage.Edit.MODES[mode] === old) {\n              delete this._modes[mode];\n              this._nextOrNone(mode);\n            } else if (L.DistortableImage.Edit.MODES[mode] === next) {\n              this._modes[mode] = next;\n            }\n          }\n          return true;\n        }\n      });\n    } finally {\n      this._rebuildingToolbar = false;\n    }\n\n    return this;\n  },\n\n  addTool(value) {\n    if (value.baseClass === 'leaflet-toolbar-icon' && !this.hasTool(value)) {\n      // Set rebuild flag during tool addition\n      this._rebuildingToolbar = true;\n\n      try {\n        this._removeToolbar();\n        this.editActions.push(value);\n        this._addToolbar();\n        for (const mode in L.DistortableImage.Edit.MODES) {\n          if (L.DistortableImage.Edit.MODES[mode] === value) {\n            this._modes[mode] = value;\n          }\n        }\n        if (!this._overlay.isSelected()) { this._removeToolbar(); }\n      } finally {\n        this._rebuildingToolbar = false;\n      }\n    }\n    return this;\n  },\n\n  hasTool(value) {\n    return this.editActions.some(action => action === value);\n  },\n\n  removeTool(value) {\n    // Set rebuild flag during tool removal\n    this._rebuildingToolbar = true;\n\n    try {\n      this.editActions.some((item, idx) => {\n        if (item === value) {\n          this._removeToolbar();\n          this.editActions.splice(idx, 1);\n          this._addToolbar();\n          for (const mode in L.DistortableImage.Edit.MODES) {\n            if (L.DistortableImage.Edit.MODES[mode] === value) {\n              delete this._modes[mode];\n              this._nextOrNone(mode);\n            }\n          }\n          return true;\n        }\n      });\n      if (!this._overlay.isSelected()) { this._removeToolbar(); }\n    } finally {\n      this._rebuildingToolbar = false;\n    }\n\n    return this;\n  },\n\n  // set the mode to the next mode or if that was the last one set mode to ''\n  _nextOrNone(mode) {\n    if (this.isMode(mode)) {\n      if (Object.keys(this.getModes()).length >= 1) {\n        this.nextMode();\n      } else {\n        if (mode === 'lock') { this._enableDragging(); }\n        this._mode = '';\n        this._updateHandle();\n      }\n    }\n  },\n\n  _removeToolbar() {\n    const ov = this._overlay;\n    const map = ov._map;\n\n    if (this.toolbar) {\n      map.removeLayer(this.toolbar);\n      this.toolbar = false;\n    }\n  },\n\n  _enableDragging() {\n    const overlay = this._overlay;\n    const map = overlay._map;\n\n    // Don't enable dragging if draggable is false\n    if (!overlay.options.draggable) {\n      return;\n    }\n\n    this.dragging = new L.Draggable(overlay.getElement());\n    this.dragging.enable();\n\n    /* Hide toolbars and markers while dragging; click will re-show it */\n    this.dragging.on('dragstart', (e) => {\n      overlay.fire('dragstart');\n      this._removeToolbar();\n\n      // Mark that a drag occurred\n      overlay._wasDragged = true;\n\n      // Determine drag behavior based on options\n      this._shouldDragMap = this._getDragBehavior();\n    });\n\n    /*\n     * Adjust default behavior of L.Draggable, which overwrites the CSS3\n     * distort transformations that we set when it calls L.DomUtil.setPosition.\n     */\n    this.dragging._updatePosition = function() {\n      const edit = overlay.editing;\n\n      // Map dragging mode\n      if (edit._shouldDragMap) {\n        if (!this._lastPos) {\n          this._lastPos = this._newPos.clone();\n        }\n\n        const delta = this._newPos.subtract(this._lastPos);\n        map.panBy(delta.multiplyBy(-1), {animate: false});\n\n        // Update last position for next iteration\n        this._lastPos = this._newPos.clone();\n        return;\n      }\n\n      // Original image dragging behavior\n      const topLeft = overlay.getCorner(0);\n      const delta = this._newPos.subtract(map.latLngToLayerPoint(topLeft));\n      let currentPoint;\n      const corners = {};\n      let i;\n\n      this.fire('predrag');\n\n      for (i = 0; i < 4; i++) {\n        currentPoint = map.latLngToLayerPoint(overlay.getCorner(i));\n        corners[i] = map.layerPointToLatLng(currentPoint.add(delta));\n      }\n\n      overlay.setCorners(corners);\n      overlay.fire('drag');\n\n      this.fire('drag');\n    };\n\n    this.dragging.on('dragend', () => {\n      // Reset for next drag\n      if (this.dragging._lastPos) {\n        delete this.dragging._lastPos;\n      }\n      overlay.fire('dragend');\n    });\n  },\n\n  _getDragBehavior() {\n    const overlay = this._overlay;\n    const dragBehavior = overlay.options.dragBehavior;\n\n    switch (dragBehavior) {\n      case 'map':\n        return true;\n      case 'overlay':\n        return false;\n      case 'auto':\n        // Auto mode: drag map if image is not selected, drag overlay if selected\n        return !overlay.isSelected();\n      default:\n        return false; // Default to overlay dragging\n    }\n  },\n\n  _disableDragging() {\n    if (this.dragging) {\n      this.dragging.disable();\n      delete this.dragging;\n    }\n  },\n\n  _refreshHandlers() {\n    // Refresh dragging behavior when drag-related options change\n    this._disableDragging();\n    if (!this.isMode('lock')) {\n      this._enableDragging();\n    }\n  },\n\n  setActions(newActions) {\n    if (!newActions || !Array.isArray(newActions)) {\n      return this;\n    }\n\n    const overlay = this._overlay;\n    const map = overlay._map;\n\n    // Set rebuild flag to prevent event firing during rebuild\n    this._rebuildingToolbar = true;\n\n    try {\n      // Store current state\n      const wasSelected = overlay.isSelected();\n      const oldMode = this._mode;\n\n      // Step 1: Clean up current handles BEFORE changing anything\n      // This ensures corner handles and other mode-specific UI is removed\n      if (this.currentHandle && map) {\n        map.removeLayer(this.currentHandle);\n        this.currentHandle = null;\n      }\n\n      // Step 2: Remove toolbar if it exists\n      if (this.toolbar) {\n        this._removeToolbar();\n      }\n\n      // Step 3: Update the actions array and reinitialize modes\n      this.editActions = newActions;\n      this._initModes();\n\n      // Step 4: Determine new mode - if old mode is no longer available, pick a new one\n      // IMPORTANT: Only set a mode if the overlay is selected\n      if (wasSelected) {\n        if (!this._modes[oldMode]) {\n          if (Object.keys(this._modes).length > 0) {\n            this._mode = Object.keys(this._modes)[0];\n          } else {\n            this._mode = '';\n          }\n        }\n      } else {\n        // For unselected overlays, clear the mode completely\n        this._mode = '';\n      }\n\n      // Step 5: Update handles for the new mode\n      // Only add handles to the map if the overlay is selected\n      if (wasSelected) {\n        this._updateHandle();\n      }\n\n      // Step 6: Restore toolbar if overlay is still selected\n      if (wasSelected && !overlay.options.suppressToolbar) {\n        this._addToolbar();\n      }\n    } finally {\n      // Always clear the rebuild flag, even if there's an error\n      this._rebuildingToolbar = false;\n    }\n\n    return this;\n  },\n\n  _dragMode() {\n    this.setMode('drag');\n  },\n\n  _scaleMode() {\n    this.setMode('scale');\n  },\n\n  _distortMode() {\n    this.setMode('distort');\n  },\n\n  _rotateMode() {\n    this.setMode('rotate');\n  },\n\n  _freeRotateMode() {\n    this.setMode('freeRotate');\n  },\n\n  _resizeRotateMode() {\n    this.setMode('resizeRotate');\n  },\n\n  _transformMode() {\n    this.setMode('transform');\n  },\n\n  _toggleLockMode() {\n    if (this.isMode('lock')) { this._unlock(); }\n    else { this._lock(); }\n  },\n\n  _toggleOpacity() {\n    const image = this._overlay.getElement();\n\n    if (!this.hasTool(L.OpacityAction)) { return; }\n\n    this._transparent = !this._transparent;\n    const opacity = this._transparent ? this.options.opacity : 1;\n\n    L.DomUtil.setOpacity(image, opacity);\n    image.setAttribute('opacity', opacity);\n\n    this._refresh();\n  },\n\n  _setOpacities(o) {\n    const image = this._overlay.getElement();\n    this._opacity = o;\n    if (!this.hasTool(L.OpacitiesAction)) { return; }\n\n    (this._opacity < 1) ? this._transparent = true : this._transparent = false;\n\n    L.DomUtil.setOpacity(image, this._opacity);\n    image.setAttribute('opacity', this._opacity);\n\n    this._refresh();\n  },\n\n  _toggleBorder() {\n    const image = this._overlay.getElement();\n\n    if (!this.hasTool(L.BorderAction)) { return; }\n\n    this._outlined = !this._outlined;\n    const outline = this._outlined ? this.options.outline : 'none';\n\n    image.style.outline = outline;\n\n    this._refresh();\n  },\n\n  // compare this to using overlay zIndex\n  _toggleOrder() {\n    if (this._toggledImage) { this._stackUp(); }\n    else { this._stackDown(); }\n  },\n\n  _removeOverlay() {\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n\n    if (this.isMode('lock') || !this.hasTool(L.DeleteAction)) { return; }\n\n    const choice = L.DomUtil.confirmDelete();\n    if (!choice) { return; }\n\n    this._removeToolbar();\n\n    if (eP) { eP.removeLayer(ov); }\n    else { ov._map.removeLayer(ov); }\n  },\n\n  // Based on https://github.com/publiclab/mapknitter/blob/8d94132c81b3040ae0d0b4627e685ff75275b416/app/assets/javascripts/mapknitter/Map.js#L47-L82\n  _getExport() {\n    const overlay = this._overlay;\n    const map = overlay._map;\n    const img = overlay.getElement();\n\n    if (!this.hasTool(L.ExportAction)) { return; }\n\n    // make a new image\n    const downloadable = new Image();\n\n    downloadable.id = downloadable.id || 'tempId12345';\n    document.body.appendChild(downloadable);\n\n    downloadable.onload = function onLoadDownloadableImage() {\n      const height = downloadable.height;\n      const width = downloadable.width;\n      const nw = map.latLngToLayerPoint(overlay.getCorner(0));\n      const ne = map.latLngToLayerPoint(overlay.getCorner(1));\n      const sw = map.latLngToLayerPoint(overlay.getCorner(2));\n      const se = map.latLngToLayerPoint(overlay.getCorner(3));\n\n      // I think this is to move the image to the upper left corner,\n      // eslint-disable-next-line max-len\n      // jywarren: i think we may need these or the image goes off the edge of the canvas\n      // jywarren: but these seem to break the distortion math...\n\n      // jywarren: i think it should be rejiggered so it\n      // finds the most negative values of x and y and then\n      // adds those to all coordinates\n\n      // nw.x -= nw.x;\n      // ne.x -= nw.x;\n      // se.x -= nw.x;\n      // sw.x -= nw.x;\n\n      // nw.y -= nw.y;\n      // ne.y -= nw.y;\n      // se.y -= nw.y;\n      // sw.y -= nw.y;\n\n      // run once warping is complete\n      downloadable.onload = function() {\n        L.DomUtil.remove(downloadable);\n      };\n\n      if (window && window.hasOwnProperty('warpWebGl')) {\n        warpWebGl(\n            downloadable.id,\n            [0, 0, width, 0, width, height, 0, height],\n            [nw.x, nw.y, ne.x, ne.y, se.x, se.y, sw.x, sw.y],\n            true // trigger download\n        );\n      }\n    };\n\n    downloadable.src = overlay.options.fullResolutionSrc || img.src;\n  },\n\n  _stackUp() {\n    const t = this._toggledImage;\n\n    if (!t || !this.hasTool(L.StackAction)) { return; }\n\n    this._toggledImage = false;\n    this._overlay.bringToFront();\n    this._refresh();\n  },\n\n  _stackDown() {\n    const t = this._toggledImage;\n\n    if (t || !this.hasTool(L.StackAction)) { return; }\n\n    this._toggledImage = true;\n    this._overlay.bringToBack();\n    this._refresh();\n  },\n\n  _unlock() {\n    const ov = this._overlay;\n    const map = ov._map;\n    const eP = this.parentGroup;\n\n    if (!this.isMode('lock')) { return; }\n    if ((eP && !eP.isCollected(ov)) || !eP) {\n      if (!this.hasTool(L.LockAction)) { return; }\n    }\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    if (ov.options.mode === 'lock' || !this.hasMode(ov.options.mode)) {\n      this._mode = '';\n      this.currentHandle = '';\n    } else {\n      this._mode = ov.options.mode;\n    }\n    this._updateHandle();\n    this._enableDragging();\n    this._refresh();\n  },\n\n  _lock() {\n    const ov = this._overlay;\n    const map = ov._map;\n    const eP = this.parentGroup;\n\n    if (this.isMode('lock')) { return; }\n    if ((eP && !eP.isCollected(ov)) || !eP) {\n      if (!this.hasTool(L.LockAction)) { return; }\n    }\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    this._mode = 'lock';\n    this._updateHandle();\n    this._disableDragging();\n    this._refresh();\n  },\n\n  _deselect() {\n    this._overlay.deselect();\n  },\n\n  _showMarkers(e) {\n    const eP = this.parentGroup;\n\n    if (!this.currentHandle) { return; }\n    // only markers we want in collect interface for now is lock\n    if (!this.isMode('lock') && (eP && eP.anyCollected())) { return; }\n\n    this.currentHandle.eachLayer((handle) => {\n      handle.setOpacity(1);\n      if (handle.dragging) { handle.dragging.enable(); }\n      L.DomUtil.addClass(handle.getElement(), 'leaflet-interactive');\n    });\n  },\n\n  _hideMarkers() {\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n\n    // workaround for race condition w/ feature group\n    if (!this._handles) { this._initHandles(); }\n\n    if (!this.currentHandle) { return; }\n    if (this.isMode('lock') && (eP && eP.isCollected(ov))) { return; }\n\n    this.currentHandle.eachLayer((handle) => {\n      handle.setOpacity(0);\n      if (handle.dragging) { handle.dragging.disable(); }\n      L.DomUtil.removeClass(handle.getElement(), 'leaflet-interactive');\n    });\n  },\n\n  _updateHandle() {\n    const ov = this._overlay;\n    const map = ov._map;\n    const mode = this.getMode();\n\n    if (this.currentHandle) { map.removeLayer(this.currentHandle); }\n    this.currentHandle = mode === '' ? '' : this._handles[mode];\n    if (this.currentHandle !== '') {\n      map.addLayer(this.currentHandle);\n    }\n  },\n\n  _addToolbar() {\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n    const map = ov._map;\n    // Find the topmost point on the image.\n    const corners = ov.getCorners();\n    let maxLat = -Infinity;\n\n    if (eP && eP.anyCollected()) {\n      eP.editing._addToolbar();\n      return;\n    }\n\n    if (ov.options.suppressToolbar || this.toolbar) { return; }\n\n    for (let i = 0; i < corners.length; i++) {\n      if (corners[i].lat > maxLat) {\n        maxLat = corners[i].lat;\n      }\n    }\n\n    // Longitude is based on the centroid of the image.\n    const raisedPoint = ov.getCenter();\n    raisedPoint.lat = maxLat;\n\n    this.toolbar = L.distortableImage.popupBar(raisedPoint, {\n      actions: this.editActions,\n    }).addTo(map, ov);\n    ov.fire('toolbar:created');\n  },\n\n  _refresh() {\n    // Set rebuild flag during toolbar refresh\n    this._rebuildingToolbar = true;\n\n    try {\n      if (this.toolbar) { this._removeToolbar(); }\n      this._addToolbar();\n    } finally {\n      this._rebuildingToolbar = false;\n    }\n  },\n\n  _updateToolbarPos() {\n    const overlay = this._overlay;\n    // Find the topmost point on the image.\n    const corners = overlay.getCorners();\n    const toolbar = this.toolbar;\n    let maxLat = -Infinity;\n\n    if (toolbar && toolbar instanceof L.DistortableImage.PopupBar) {\n      for (let i = 0; i < corners.length; i++) {\n        if (corners[i].lat > maxLat) {\n          maxLat = corners[i].lat;\n        }\n      }\n\n      // Longitude is based on the centroid of the image.\n      const raisedPoint = overlay.getCenter();\n      raisedPoint.lat = maxLat;\n\n      if (!overlay.options.suppressToolbar) {\n        this.toolbar.setLatLng(raisedPoint);\n      }\n    }\n  },\n\n  hasMode(mode) {\n    return !!this._modes[mode];\n  },\n\n  getMode() {\n    if (!this.enabled()) { return; }\n    return this._mode;\n  },\n\n  getModes() {\n    return this._modes;\n  },\n\n  isMode(mode) {\n    if (!this.enabled()) { return false; }\n    return this._mode === mode;\n  },\n\n  setMode(newMode) {\n    const ov = this._overlay;\n    const eP = this.parentGroup;\n    const mode = this.getMode();\n\n    if (mode === newMode || !this.hasMode(newMode) || !this.enabled()) {\n      return;\n    }\n\n    if (this.toolbar) { this.toolbar.clickTool(newMode); }\n    if (this.isMode('lock') && !this.dragging) { this._enableDragging(); }\n    this._mode = newMode;\n    if (this.isMode('lock')) { this._disableDragging(); }\n    this._updateHandle();\n    this._refresh();\n\n    if (eP && eP.isCollected(ov)) { ov.deselect(); }\n\n    return this;\n  },\n\n  /**\n    * need to attach a stop to img dblclick or it will propagate to\n    * the map and fire the handler that shows map location labels on map dblclick.\n    */\n  nextMode(e) {\n    const mode = this.getMode();\n    const eP = this.parentGroup;\n    const modesArray = Object.keys(this.getModes());\n    const idx = modesArray.indexOf(mode);\n    const nextIdx = (idx + 1) % modesArray.length;\n    const newMode = modesArray[nextIdx];\n\n    if (e) {\n      if (eP && eP.anyCollected()) { return; }\n      L.DomEvent.stop(e);\n    }\n\n    return this.setMode(newMode);\n  },\n});\n\nL.distortableImage.edit = (overlay, options) => {\n  return new L.DistortableImage.Edit(overlay, options);\n};\n","L.BorderAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    const mode = edit._mode;\n    let use;\n    let tooltip;\n\n    if (edit._outlined) {\n      use = 'border_outer';\n      tooltip = overlay.options.translation.removeBorder;\n    } else {\n      use = 'border_clear';\n      tooltip = overlay.options.translation.addBorder;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: mode === 'lock' ? 'disabled' : '',\n    };\n\n    // conditional for disabling keybindings for this action when the image is locked.\n    L.DistortableImage.action_map.b = mode === 'lock' ? '' : '_toggleBorder';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    L.IconUtil.toggleXlink(this._link, 'border_clear', 'border_outer');\n    L.IconUtil.toggleTitle(this._link, 'Remove Border', 'Add Border');\n    edit._toggleBorder();\n  },\n});\n","L.DeleteAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    const use = 'delete_forever';\n    let tooltip;\n    /**\n      * we can tell whether the overlay is an instance of `L.DistortableImageOverlay` or `L.DistortableCollection` bc only\n      * the former should have `parentGroup` defined on it. From there we call the apporpriate keybindings and methods.\n      */\n    if (edit instanceof L.DistortableImage.Edit) {\n      tooltip = overlay.options.translation.deleteImage;\n      // backspace windows / delete mac\n      L.DistortableImage.action_map.Backspace = (\n        edit._mode === 'lock' ? '' : '_removeOverlay'\n      );\n    } else {\n      tooltip = overlay.options.translation.deleteImages;\n      L.DistortableImage.group_action_map.Backspace = (\n        edit._mode === 'lock' ? '' : '_removeGroup'\n      );\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) { edit._removeOverlay(); }\n    else { edit._removeGroup(); }\n  },\n});\n","L.DistortAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'distort',\n      tooltip: overlay.options.translation.distortImage,\n      className: 'distort',\n    };\n\n    L.DistortableImage.action_map.d = '_distortMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._distortMode();\n  },\n});\n","L.DragAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'drag',\n      tooltip: overlay.options.translation.dragImage,\n      className: 'drag',\n    };\n\n    L.DistortableImage.action_map.D = '_dragMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._dragMode();\n  },\n});\n","L.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.action_map = {};\n\nL.EditAction = L.Toolbar2.Action.extend({\n  options: {\n    toolbarIcon: {\n      svg: false,\n      html: '',\n      className: '',\n      tooltip: '',\n    },\n  },\n\n  initialize(map, overlay, options) {\n    this._overlay = overlay;\n    this._map = map;\n\n    L.setOptions(this, options);\n    L.Toolbar2.Action.prototype.initialize.call(this, options);\n\n    this._injectIconSet();\n  },\n\n  _createIcon(toolbar, container, args) {\n    const iconOptions = this.options.toolbarIcon;\n    const className = iconOptions.className;\n    const edit = this._overlay.editing;\n    const style = this.options.toolbarIcon.style;\n\n    this.toolbar = toolbar;\n    this._icon = L.DomUtil.create('li', '', container);\n    this._link = L.DomUtil.create('a', '', this._icon);\n\n    if (iconOptions.svg) {\n      this._link.innerHTML = L.IconUtil.create(iconOptions.html);\n    } else {\n      this._link.innerHTML = iconOptions.html;\n    }\n\n    this._link.setAttribute('href', '#');\n    this._link.setAttribute('title', iconOptions.tooltip);\n    if (style) { this._link.setAttribute('style', style); };\n    this._link.setAttribute('role', 'button');\n\n    L.DomUtil.addClass(this._link, this.constructor.baseClass);\n\n    if (className) {\n      L.DomUtil.addClass(this._link, className);\n      if (className === 'disabled') {\n        L.DomUtil.addClass(this._icon, className);\n      }\n      if (className === edit._mode) {\n        L.DomUtil.addClass(this._link, 'selected-mode');\n      } else {\n        L.DomUtil.removeClass(this._link, 'selected-mode');\n      }\n    }\n\n    L.DomEvent.on(this._link, 'click', this.enable, this);\n    L.DomEvent.on(this._overlay, 'update', () => {\n      const match = this._link.innerHTML.match(/xlink:href=\"#restore\"/);\n      if (match && match.length === 1) { this._enableAction(); }\n    });\n\n    /* Add secondary toolbar */\n    this._addSubToolbar(toolbar, this._icon, args);\n  },\n\n  _injectIconSet() {\n    if (document.querySelector('#iconset')) {\n      return;\n    }\n\n    const el = document.createElement('div');\n    el.id = 'iconset';\n    el.setAttribute('hidden', 'hidden');\n    el.innerHTML = new L.ToolbarIconSet().render();\n\n    document.querySelector('.leaflet-marker-pane').appendChild(el);\n  },\n\n  _enableAction() {\n    L.DomUtil.removeClass(this._link.parentElement, 'disabled');\n    L.DomUtil.removeClass(this._link, 'disabled');\n  },\n\n  _disableAction() {\n    L.DomUtil.addClass(this._link.parentElement, 'disabled');\n    L.DomUtil.addClass(this._link, 'disabled');\n  },\n});\n\nL.editAction = function(map, overlay, options) {\n  return new L.EditAction(map, overlay, options);\n};\n","L.ExportAction = L.EditAction.extend({\n  // This function is executed every time we select an image\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    let tooltip;\n\n    this.isExporting = false;\n    this.mouseLeaveSkip = true;\n    this.isHooksExecuted = false;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      L.DistortableImage.action_map.e = '_getExport';\n      tooltip = overlay.options.translation.exportImage;\n    } else {\n      L.DistortableImage.group_action_map.e = 'runExporter';\n      tooltip = overlay.options.translation.exportImages;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'get_app',\n      tooltip: tooltip,\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      edit._getExport();\n      return;\n    }\n\n    // Make sure that addHooks is executed only once, event listeners will handle the rest\n    if (this.isHooksExecuted) {\n      return;\n    } else {\n      this.isHooksExecuted = true;\n    }\n\n    const exportTool = this._link.parentElement;\n\n    this.mouseEnterHandler = this.handleMouseEnter.bind(this);\n    this.mouseLeaveHandler = this.handleMouseLeave.bind(this);\n\n    L.DomEvent.on(exportTool, 'click', function() {\n      if (!this.isExporting) {\n        this.isExporting = true;\n        this.renderExportIcon();\n\n        setTimeout(this.attachMouseEventListeners.bind(this, exportTool), 100);\n        edit.runExporter().then(\n            function() {\n              this.resetState();\n              this.detachMouseEventListeners(exportTool);\n            }.bind(this)\n        );\n      } else {\n        // Clicking on the export icon after export has started will be ignored\n        if (this.mouseLeaveSkip) {\n          return;\n        }\n\n        this.resetState();\n        this.detachMouseEventListeners(exportTool);\n        edit.cancelExport();\n      }\n    }, this);\n  },\n\n  resetState() {\n    this.renderDownloadIcon();\n    this.isExporting = false;\n    this.mouseLeaveSkip = true;\n  },\n\n  attachMouseEventListeners(element) {\n    element.addEventListener('mouseenter', this.mouseEnterHandler);\n    element.addEventListener('mouseleave', this.mouseLeaveHandler);\n  },\n\n  detachMouseEventListeners(element) {\n    element.removeEventListener('mouseenter', this.mouseEnterHandler);\n    element.removeEventListener('mouseleave', this.mouseLeaveHandler);\n  },\n\n  handleMouseEnter() {\n    this.renderCancelIcon();\n  },\n\n  handleMouseLeave() {\n    if (this.mouseLeaveSkip) {\n      this.mouseLeaveSkip = false;\n    } else {\n      this.renderExportIcon();\n    }\n  },\n\n  renderDownloadIcon() {\n    L.IconUtil.toggleXlink(this._link, 'get_app', 'spinner');\n    L.IconUtil.toggleTitle(this._link, 'Export Images', 'Loading...');\n    L.DomUtil.removeClass(this._link.firstChild, 'loader');\n  },\n\n  renderExportIcon() {\n    L.IconUtil.toggleXlink(this._link, 'spinner');\n    L.IconUtil.toggleTitle(this._link, 'Export Images', 'Loading...');\n    L.IconUtil.addClassToSvg(this._link, 'loader');\n  },\n\n  renderCancelIcon() {\n    L.IconUtil.toggleXlink(this._link, 'cancel');\n    L.IconUtil.toggleTitle(this._link, 'Cancel Export', 'Loading...');\n    L.DomUtil.removeClass(this._link.firstChild, 'loader');\n  },\n});\n","L.FreeRotateAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'crop_rotate',\n      tooltip: overlay.options.translation.freeRotateImage,\n      className: 'freeRotate',\n    };\n\n    L.DistortableImage.action_map.f = '_freeRotateMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._freeRotateMode();\n  },\n});\n","L.GeolocateAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'explore',\n      tooltip: overlay.options.translation.geolocateImage,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const image = this._overlay.getElement();\n\n    EXIF.getData(image, L.EXIF(image));\n  },\n});\n","L.LockAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    let use;\n    let tooltip;\n\n    if (edit instanceof L.DistortableImage.Edit) {\n      L.DistortableImage.action_map.u = '_unlock';\n      L.DistortableImage.action_map.l = '_lock';\n      tooltip = overlay.options.translation.lockMode;\n\n      use = edit.isMode('lock') ? 'lock' : 'unlock';\n    } else {\n      L.DistortableImage.group_action_map.l = '_lockGroup';\n      tooltip = overlay.options.translation.lockImages;\n      use = 'lock';\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: 'lock',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    if (edit instanceof L.DistortableImage.Edit) { edit._toggleLockMode(); }\n    else { edit._lockGroup(); }\n  },\n});\n","let opacities = [100, 80, 60, 40, 20, 0]; // Set numeric values from 0 to 100.\n\n// TODO: 'new CSSStyleSheet()' gives 'TypeError: Illegal constructor' on tablet browsers, find another solution and uncomment\n// // Add custom CSS scripts and overwrites. Pending for better implementation of CSSStyleSheet in browsers.\n// const subtoolbarCss = new CSSStyleSheet();\n// subtoolbarCss.replaceSync(\n//     `.leaflet-toolbar-icon-vertical {\n//         box-sizing: border-box !important;\n//         display: block !important;\n//         width: 30px !important;\n//         height: 30px !important;\n//         line-height: 30px !important;\n//         padding: 0 !important;\n//         text-align: center !important;\n//         text-decoration: none !important;\n//         background-color: #fff;\n//         border: inset 0.5px lightgray !important;\n//         font-size: 12px !important;\n//         font-weight: bold !important;\n//         color:#0087A8 !important;\n//         float: none !important;\n//         margin: auto !important;\n//         z-index:900 !important;\n//       }\n//     `\n// );\n//\n// subtoolbarCss.insertRule(\n//     `.leaflet-toolbar-1 li:first-child a {\n//         border-radius: 4px 4px 0px 0px !important;\n//     }`\n// );\n// document.adoptedStyleSheets = [subtoolbarCss];\n\nopacities = opacities.map((o) => {\n  (isNaN(o) || o > 100) ? o = 100 : o;\n  (o < 0) ? o = 0 : o;\n\n  return L.EditAction.extend({\n    options: {\n      toolbarIcon: {\n        html: o,\n        tooltip: 'Opacity ' + o +'%',\n        className: 'leaflet-toolbar-icon-vertical',\n        style: 'background-color:rgb(' + (100 - o) + '%,' + (100 - o) + '%,' + (100 - o) + '%);',\n      },\n    },\n    addHooks() {\n      this._overlay.editing._setOpacities(o/100);\n    },\n  });\n});\n\nL.OpacitiesToolbar2 = L.Toolbar2.extend({\n  options: {\n    className: '',\n    filter: function() { return true; },\n    actions: [],\n    style: `translate(-1px, -${ ((opacities.length + 1) * 30)}px)`,\n  },\n\n  appendToContainer(container) {\n    const baseClass = this.constructor.baseClass + '-' + this._calculateDepth();\n    const className = baseClass + ' ' + this.options.className;\n    let Action; let action;\n    let i; let j; let l; let m;\n\n    this._container = container;\n    this._ul = L.DomUtil.create('ul', className, container);\n    this._ul.style.transform = ( this.options.style ) ? this.options.style : '';\n\n    // Ensure that clicks, drags, etc. don't bubble up to the map.\n    // These are the map events that the L.Draw.Polyline handler listens for.\n    // Note that L.Draw.Polyline listens to 'mouseup', not 'mousedown', but\n    // if only 'mouseup' is silenced, then the map gets stuck in a halfway\n    // state because it receives a 'mousedown' event and is waiting for the\n    // corresponding 'mouseup' event.\n    this._disabledEvents = [\n      'click', 'mousemove', 'dblclick',\n      'mousedown', 'mouseup', 'touchstart',\n    ];\n\n    for (j = 0, m = this._disabledEvents.length; j < m; j++) {\n      L.DomEvent.on(this._ul, this._disabledEvents[j], L.DomEvent.stopPropagation);\n    }\n\n    /* Instantiate each toolbar action and add its corresponding toolbar icon. */\n    for (i = 0, l = this.options.actions.length; i < l; i++) {\n      Action = this._getActionConstructor(this.options.actions[i]);\n\n      action = new Action();\n      action._createIcon(this, this._ul, this._arguments);\n    }\n  },\n});\n\n\nL.OpacitiesAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    const mode = edit._mode;\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'opacities',\n      tooltip: 'Set custom opacity',\n      className: mode === 'lock' ? 'disabled' : '',\n    };\n\n    options.subToolbar = new L.OpacitiesToolbar2({\n      actions: opacities,\n    });\n\n    L.DistortableImage.action_map.o = mode === 'lock' ? '' : '_setOpacities';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const link = this._link;\n    if (L.DomUtil.hasClass(link, 'subtoolbar_enabled')) {\n      L.DomUtil.removeClass(link, 'subtoolbar_enabled');\n      setTimeout(() => {\n        this.options.subToolbar._hide();\n      }, 100);\n    } else {\n      L.DomUtil.addClass(link, 'subtoolbar_enabled');\n    };\n\n    L.IconUtil.toggleXlink(link, 'opacities', 'cancel');\n    L.IconUtil.toggleTitle(link, 'Make Image Transparent', 'Cancel');\n  },\n});\n","L.OpacityAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    const mode = edit._mode;\n    let use;\n    let tooltip;\n\n    if (edit._transparent) {\n      use = 'opacity_empty';\n      tooltip = overlay.options.translation.makeImageOpaque;\n    } else {\n      use = 'opacity';\n      tooltip = overlay.options.translation.makeImageTransparent;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.DistortableImage.action_map.o = mode === 'lock' ? '' : '_toggleOpacity';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    const link = this._link;\n\n    L.IconUtil.toggleXlink(link, 'opacity', 'opacity_empty');\n    L.IconUtil.toggleTitle(link, 'Make Image Transparent', 'Make Image Opaque');\n    edit._toggleOpacity();\n  },\n});\n","L.ResizeRotateAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'spinner',\n      tooltip: overlay.options.translation.resizeRotateImage,\n      className: 'resizeRotate',\n    };\n\n    L.DistortableImage.action_map.f = '_resizeRotateMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._resizeRotateMode();\n  },\n});\n","L.RestoreAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const mode = L.Utils.getNestedVal(overlay, 'editing', '_mode');\n    const edited = overlay.edited;\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'restore',\n      tooltip: overlay.options.translation.restoreImage,\n      className: edited && mode !== 'lock' ? '' : 'disabled',\n    };\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const ov = this._overlay;\n\n    L.DomEvent.on(ov, {\n      edit: this._enableAction,\n      restore: this._disableAction,\n    }, this);\n\n    ov.restore();\n  },\n});\n","L.RotateAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'rotate',\n      tooltip: overlay.options.translation.rotateImage,\n      className: 'rotate',\n    };\n\n    L.DistortableImage.action_map.r = '_rotateMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._rotateMode();\n  },\n});\n","L.ScaleAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'scale',\n      tooltip: overlay.options.translation.scaleImage,\n      className: 'scale',\n    };\n\n    L.DistortableImage.action_map.s = '_scaleMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._scaleMode();\n  },\n});\n","L.StackAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    const edit = overlay.editing;\n    let use;\n    let tooltip;\n\n    if (edit._toggledImage) {\n      use = 'flip_to_back';\n      tooltip = overlay.options.translation.stackToFront;\n    } else {\n      use = 'flip_to_front';\n      tooltip = overlay.options.translation.stackToBack;\n    }\n\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: use,\n      tooltip: tooltip,\n      className: edit._mode === 'lock' ? 'disabled' : '',\n    };\n\n    L.DistortableImage.action_map.q = edit._mode === 'lock' ? '' : '_stackUp';\n    L.DistortableImage.action_map.a = edit._mode === 'lock' ? '' : '_stackDown';\n\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n\n    L.IconUtil.toggleXlink(this._link, 'flip_to_front', 'flip_to_back');\n    L.IconUtil.toggleTitle(this._link, 'Stack to Front', 'Stack to Back');\n    edit._toggleOrder();\n  },\n});\n","L.TransformAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'spinner',\n      tooltip: overlay.options.translation.transformImage,\n      className: 'transform',\n    };\n\n    L.DistortableImage.action_map.f = '_transformMode';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._transformMode();\n  },\n});\n","L.UnlockAction = L.EditAction.extend({\n  initialize(map, overlay, options) {\n    options = options || {};\n    options.toolbarIcon = {\n      svg: true,\n      html: 'unlock',\n      tooltip: overlay.options.translation.unlockImages,\n    };\n\n    L.DistortableImage.group_action_map.u = '_unlockGroup';\n    L.EditAction.prototype.initialize.call(this, map, overlay, options);\n  },\n\n  addHooks() {\n    const edit = this._overlay.editing;\n    edit._unlockGroup();\n  },\n});\n","/* eslint-disable no-unused-vars */\nL.EXIF = function getEXIFdata(img) {\n  if (Object.keys(EXIF.getAllTags(img)).length !== 0) {\n    console.log(EXIF.getAllTags(img));\n    const GPS = EXIF.getAllTags(img);\n    let altitude;\n\n    /* If the lat/lng is available. */\n    if (\n      typeof GPS.GPSLatitude !== 'undefined' &&\n      typeof GPS.GPSLongitude !== 'undefined'\n    ) {\n      // sadly, encoded in [degrees,minutes,seconds]\n      // primitive value = GPS.GPSLatitude[x].numerator\n      let lat =\n        GPS.GPSLatitude[0] +\n        GPS.GPSLatitude[1] / 60 +\n        GPS.GPSLatitude[2] / 3600;\n      let lng =\n        GPS.GPSLongitude[0] +\n        GPS.GPSLongitude[1] / 60 +\n        GPS.GPSLongitude[2] / 3600;\n\n      if (GPS.GPSLatitudeRef !== 'N') {\n        lat = lat * -1;\n      }\n      if (GPS.GPSLongitudeRef === 'W') {\n        lng = lng * -1;\n      }\n    }\n\n    // Attempt to use GPS compass heading; will require\n    // some trig to calc corner points, which you can find below:\n\n    let angle = 0;\n    // \"T\" refers to \"True north\", so -90.\n    if (GPS.GPSImgDirectionRef === 'T') {\n      angle =\n        (Math.PI / 180) *\n        (GPS.GPSImgDirection.numerator / GPS.GPSImgDirection.denominator - 90);\n      // \"M\" refers to \"Magnetic north\"\n    } else if (GPS.GPSImgDirectionRef === 'M') {\n      angle =\n        (Math.PI / 180) *\n        (GPS.GPSImgDirection.numerator / GPS.GPSImgDirection.denominator - 90);\n    } else {\n      console.log('No compass data found');\n    }\n\n    console.log('Orientation:', GPS.Orientation);\n\n    /* If there is orientation data -- i.e. landscape/portrait etc */\n    if (GPS.Orientation === 6) {\n      // CCW\n      angle += (Math.PI / 180) * -90;\n    } else if (GPS.Orientation === 8) {\n      // CW\n      angle += (Math.PI / 180) * 90;\n    } else if (GPS.Orientation === 3) {\n      // 180\n      angle += (Math.PI / 180) * 180;\n    }\n\n    /* If there is altitude data */\n    if (\n      typeof GPS.GPSAltitude !== 'undefined' &&\n      typeof GPS.GPSAltitudeRef !== 'undefined'\n    ) {\n      // Attempt to use GPS altitude:\n      // (may eventually need to find EXIF field of view for correction)\n      if (\n        typeof GPS.GPSAltitude !== 'undefined' &&\n        typeof GPS.GPSAltitudeRef !== 'undefined'\n      ) {\n        altitude =\n          GPS.GPSAltitude.numerator / GPS.GPSAltitude.denominator +\n          GPS.GPSAltitudeRef;\n      } else {\n        altitude = 0; // none\n      }\n    }\n  } else {\n    alert('EXIF initialized. Press again to view data in console.');\n  }\n};\n","L.DistortHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'distort',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAChSURBVO3BIU4DURgGwNkvL2B6AkQTLBqP4QCoSm7DDXoBLBZHDbfgICAIZjEV3YTn9uVHdMZZtcnCfI13bIzxg0emg6Nm6QVbYz3jylEsXRrvwommb49X67jFkz80fR9Mb1YxTzqiWBSLYlEsikWxKBbFolgUi2JRLIpFsSgWxaJY03fHHOu40dH07bAzWCx9Ge/TiWbpHgdsjPGNB2f/yS+7xRCyiiZPJQAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n\n    overlay.setCorner(this._corner, this.getLatLng());\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.distortHandle = function(overlay, idx, options) {\n  return new L.DistortHandle(overlay, idx, options);\n};\n","L.DragHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'drag',\n    icon: L.icon({\n      // eslint-disable-next-line max-len\n      iconUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAsVJREFUeNrMVztLXEEUvnNVFAVBAhY2aRKbTZEHJNpYabuNjSgYg/GxdsmPSJkUAa/ZdVEX8mgWYVutbHxAHkVskjQBuUUgBISVhCQk3wnfwMlk1rusN1wHPubOzJlzvjlz5sxc01Ma/hUEwQnwDIjqc7uvgv9YYO86qgIwCXQbdNTlQ8kcCBHgBch8TcloF6oJGr6phk6EQAkfdz3zvgDr9Mr7Fg1fptEZoM8jsmrokpfsiIFO4IIjuE2v1EDmR4LRdlR5Gh51hj8D34ABtm8YTtqna0TgklIw5CgQguKxIojEjmFROg/MKQO27NkFAB+4wAPouGUJiIvWKHwbAxX2XyWRKWkqhT+pbJntJZJuUzISW0+5hW+obxrVBsfvoH/dqCCJuU97GBh2VteLSiYvArmErT8EVoAK9Bw7enbpVYmvAQlyowYforrH5jXL2rPHI/TKONDB7u9AlavdaTBPvPmazUeQuy8f7UomUgTEwIJPEQ3sQGE/6ll2l9H/KcEzBcfWn2IclluM3DpddJxSHujlFkscbUPvmB0LHVnLrId7nlaZVkEc6QGXQI1MAwZcWmVRHeNaQwJMMiU2cwy4s7p/RJ2ckpvIQs+cIs+5GzitloLKHUV3MPREuXbTOKO91dX387gGTONxIgEWm+E61FFrpcyqXLHsEwiDjEsjAksqw5XPoL9MHVrn6QR4q+XZrDaR4RoWzq2ymafuRA/Mq1stSsHLVkcbdf9VjOcx8ZH3+SFWcCWlVPyWuUBOwUWdC1wP5NVjYiXFWLO69PZ6CRTUY6KSIoEKdf6T3IzzgHxnsyHctNBEkmn6Oob8ExUDg/ahGybd177cDjzH5xHwgDiSvoS7I/LZyvxJZj0wod7tkX5G0XVC7rEyLhfLJjBGbKoLLEfZWObyKeZ6oY82g+yf5Zn/mJyHX7PMf04z/T3/LcAAu4E6iiyJqf0AAAAASUVORK5CYII=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n\n    overlay.dragBy(formerLatLng, newLatLng);\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.dragHandle = function(overlay, idx, options) {\n  return new L.DragHandle(overlay, idx, options);\n};\n","L.EditHandle = L.Marker.extend({\n  initialize(overlay, corner, options) {\n    const latlng = overlay.getCorner(corner);\n\n    L.setOptions(this, options);\n\n    this._handled = overlay;\n    this._corner = corner;\n\n    const markerOptions = {\n      draggable: true,\n      zIndexOffset: 10,\n    };\n\n    if (options && options.hasOwnProperty('draggable')) {\n      markerOptions.draggable = options.draggable;\n    }\n\n    L.Marker.prototype.initialize.call(this, latlng, markerOptions);\n  },\n\n  onAdd(map) {\n    L.Marker.prototype.onAdd.call(this, map);\n    this._bindListeners();\n    this.updateHandle();\n  },\n\n  onRemove(map) {\n    this._unbindListeners();\n    L.Marker.prototype.onRemove.call(this, map);\n  },\n\n  _onHandleDragStart() {\n    this._handled.fire('editstart');\n  },\n\n  _onHandleDragEnd() {\n    this._fireEdit();\n  },\n\n  _fireEdit() {\n    this._handled.edited = true;\n    this._handled.fire('edit');\n  },\n\n  _bindListeners() {\n    this.on({\n      contextmenu: L.DomEvent.stop,\n      dragstart: this._onHandleDragStart,\n      drag: this._onHandleDrag,\n      dragend: this._onHandleDragEnd,\n    }, this);\n\n    this._handled._map.on('zoomend', this.updateHandle, this);\n    this._handled.on('update', this.updateHandle, this);\n  },\n\n  _unbindListeners() {\n    this.off({\n      contextmenu: L.DomEvent.stop,\n      dragstart: this._onHandleDragStart,\n      drag: this._onHandleDrag,\n      dragend: this._onHandleDragEnd,\n    }, this);\n\n    this._handled._map.off('zoomend', this.updateHandle, this);\n    this._handled.off('update', this.updateHandle, this);\n  },\n\n  /* Takes two latlngs and calculates the scaling difference. */\n  _calculateScalingFactor(latlngA, latlngB, anchor = null) {\n    const overlay = this._handled;\n    const map = overlay._map;\n\n    const centerPoint = map.latLngToLayerPoint(anchor || overlay.getCenter());\n    const formerPoint = map.latLngToLayerPoint(latlngA);\n    const newPoint = map.latLngToLayerPoint(latlngB);\n    const formerRadiusSquared = this._d2(centerPoint, formerPoint);\n    const newRadiusSquared = this._d2(centerPoint, newPoint);\n\n    return Math.sqrt(newRadiusSquared / formerRadiusSquared);\n  },\n\n  /* Distance between two points in cartesian space, squared (distance formula). */\n  _d2(a, b) {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n\n    return Math.pow(dx, 2) + Math.pow(dy, 2);\n  },\n\n  /* Takes two latlngs and calculates the angle between them. */\n  calculateAngleDelta(latlngA, latlngB, anchor = null) {\n    const overlay = this._handled;\n    const map = overlay._map;\n\n\n    const centerPoint = map.latLngToLayerPoint(anchor || overlay.getCenter());\n    const formerPoint = map.latLngToLayerPoint(latlngA);\n    const newPoint = map.latLngToLayerPoint(latlngB);\n\n    const initialAngle = (\n      Math.atan2(centerPoint.y - formerPoint.y, centerPoint.x - formerPoint.x)\n    );\n    const newAngle = (\n      Math.atan2(centerPoint.y - newPoint.y, centerPoint.x - newPoint.x)\n    );\n\n    return newAngle - initialAngle;\n  },\n});\n","L.FreeRotateHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'freeRotate',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAHiSURBVMXBa3HbShgA0PMp/1sCCo8oCEpgTaCXgIXAJiDzyCJoAUTm4UVQAns1Y8+snWnTvJyeE16hkjDgDrfoNTMKcpC9UPiLSo8JyetkjEHxjPCMyoS199kFoz8Iv1HpMaN3qWDCHoegOKkkRwnJpRmroHgiPFEZ8IBekzEGxQtUEhKSS/fB7Ew4U+lxcGkVZG9QWWPSFAxBcdK59KApuA+yNwp2uEdx1GN25sZJZULSfAtm77SlbNjju6MvG75u+WHRWVR6rDVjMPsgwYyVZl3pLTpHkyYHOx8syMiayaJzlDTZ9YyaZNFVkiYH2ZUEBcVJJXVImuz6Js3Qofe59pq7DoOTILu+g+a288mCouk7/1iH4qTS+2QdDppbV1ZJmrnDXnPnc5UOs2Z0fUmTuyBr+krvSioJyUmQO0dZM7mepMkWnaNRkyrJB6uskTSjxY3Fll8bvmJwlDb83FJ8gMqAB80uyBY3Trb82PAfvjj6vuHnluIdKgMeNXOwctK5NKBoHitrb1RJeHRp5Ux4ojLg0aWMHGQvUOkxIWkKVsHsTPiNSo8HDC5lZIsgO6n0uMUdRvQuFQxB8UR4RmXC2vvsgtEfhL+o9JiQvE7GGBTPCK9QSUjoMWgKDthjDrIX+h/k0I7gth6N5gAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const map = overlay._map;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n    const angle = this.calculateAngleDelta(formerLatLng, newLatLng);\n    const scale = this._calculateScalingFactor(formerLatLng, newLatLng);\n\n    if (angle !== 0) { overlay.rotateBy(angle, 'rad'); }\n\n    let edgeMinWidth = overlay.edgeMinWidth;\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n\n    const corner1 = map.latLngToContainerPoint(overlay.getCorner(0));\n    const corner2 = map.latLngToContainerPoint(overlay.getCorner(1));\n    const w = Math.abs(corner1.x - corner2.x);\n    const h = Math.abs(corner1.y - corner2.y);\n    const distance = Math.sqrt(w * w + h * h);\n    if (distance > edgeMinWidth || scale > 1) {\n      overlay.scaleBy(scale);\n    } else {\n      overlay.scaleBy(1);\n    }\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.freeRotateHandle = (overlay, idx, options) => {\n  return new L.FreeRotateHandle(overlay, idx, options);\n};\n","L.LockHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'lock',\n    interactive: false,\n    icon: L.icon({\n      // eslint-disable-next-line max-len\n      iconUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAD8SURBVO3BPU7CYAAA0AdfjIcQlRCQBG7C3gk2uIPG2RC3Dk16Gz0FTO1WZs/gwGCMP/2+xsSl7+n1er1Iz9LtRQjaPeMeO+TinLDCJV78YqjdA04YodKuxhUaPGoRxMmxwRQZSt87Yo4KExGCeAUyLLFB4bMacxywEClIU2KDKXbInTUYo8JCgoFuGoxQO5uiwY1EA91VmDqrcKeDoX8WdNNgjApvmGGLXKIgXY0xGkxQYItrrFFIEKQ5Yo4KEx9yrDFDhlKkIF6NOQ5Y+KpAhiXWKEQI4pxwiwoLPyuxwQw75FoE7fZYocFEuwI7jHCBV39gL92TXq/Xi/AOcmczZmaIMScAAAAASUVORK5CYII=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  onRemove(map) {\n    this.unbindTooltip();\n    L.EditHandle.prototype.onRemove.call(this, map);\n  },\n\n  _bindListeners() {\n    const icon = this.getElement();\n\n    L.EditHandle.prototype._bindListeners.call(this);\n\n    L.DomEvent.on(icon, {\n      mousedown: this._tooltipOn,\n      mouseup: this._tooltipOff,\n    }, this);\n\n    L.DomEvent.on(document, 'pointerleave', this._tooltipOff, this);\n  },\n\n  _unbindListeners() {\n    const icon = this.getElement();\n\n    L.EditHandle.prototype._bindListeners.call(this);\n\n    L.DomEvent.off(icon, {\n      mousedown: this._tooltipOn,\n      mouseup: this._tooltipOff,\n    }, this);\n\n    L.DomEvent.off(document, 'pointerleave', this._tooltipOff, this);\n  },\n\n  /* cannot be dragged */\n  _onHandleDrag() {\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n\n  _tooltipOn(e) {\n    const eP = this._handled.parentGroup;\n    const edit = eP ? eP.editing : this._handled.editing;\n\n    if (e.shiftKey) { return; }\n    if (!this._handled.isSelected() && (eP && !eP.isCollected(this._handled))) {\n      return;\n    }\n\n    const handlesArr = edit._lockHandles;\n\n    this._timer = setTimeout(L.bind(function() {\n      if (this._timeout) { clearTimeout(this._timeout); }\n\n      if (!this.getTooltip()) {\n        this.bindTooltip('Locked!', {permanent: true});\n      } else {\n        handlesArr.eachLayer(function(handle) {\n          if (this !== handle) { handle.closeTooltip(); }\n        });\n      }\n\n      this.openTooltip();\n    }, this), 500);\n  },\n\n  _tooltipOff(e) {\n    const eP = this._handled.parentGroup;\n    const edit = eP ? eP.editing : this._handled.editing;\n\n    if (e.shiftKey) { return; }\n    if (!this._handled.isSelected() && (eP && !eP.isCollected(this._handled))) {\n      return;\n    }\n\n    const handlesArr = edit._lockHandles;\n\n    if (e.currentTarget === document) {\n      handlesArr.eachLayer(function(handle) {\n        handle.closeTooltip();\n      });\n    }\n\n    if (this._timer) { clearTimeout(this._timer); }\n\n    this._timeout = setTimeout(L.bind(function() {\n      this.closeTooltip();\n    }, this), 400);\n  },\n});\n\nL.lockHandle = function(overlay, idx, options) {\n  return new L.LockHandle(overlay, idx, options);\n};\n","L.ResizeRotateHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'resizeRotate',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAHiSURBVMXBa3HbShgA0PMp/1sCCo8oCEpgTaCXgIXAJiDzyCJoAUTm4UVQAns1Y8+snWnTvJyeE16hkjDgDrfoNTMKcpC9UPiLSo8JyetkjEHxjPCMyoS199kFoz8Iv1HpMaN3qWDCHoegOKkkRwnJpRmroHgiPFEZ8IBekzEGxQtUEhKSS/fB7Ew4U+lxcGkVZG9QWWPSFAxBcdK59KApuA+yNwp2uEdx1GN25sZJZULSfAtm77SlbNjju6MvG75u+WHRWVR6rDVjMPsgwYyVZl3pLTpHkyYHOx8syMiayaJzlDTZ9YyaZNFVkiYH2ZUEBcVJJXVImuz6Js3Qofe59pq7DoOTILu+g+a288mCouk7/1iH4qTS+2QdDppbV1ZJmrnDXnPnc5UOs2Z0fUmTuyBr+krvSioJyUmQO0dZM7mepMkWnaNRkyrJB6uskTSjxY3Fll8bvmJwlDb83FJ8gMqAB80uyBY3Trb82PAfvjj6vuHnluIdKgMeNXOwctK5NKBoHitrb1RJeHRp5Ux4ojLg0aWMHGQvUOkxIWkKVsHsTPiNSo8HDC5lZIsgO6n0uMUdRvQuFQxB8UR4RmXC2vvsgtEfhL+o9JiQvE7GGBTPCK9QSUjoMWgKDthjDrIX+h/k0I7gth6N5gAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const map = overlay._map;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const anchorLatLng = overlay.getOppositeCorner(this._corner);\n    const newLatLng = this.getLatLng();\n\n    const angle = this.calculateAngleDelta(formerLatLng, newLatLng, anchorLatLng);\n    const scale = this._calculateScalingFactor(formerLatLng, newLatLng, anchorLatLng);\n\n    if (angle !== 0) {\n      overlay.rotateBy(angle, 'rad', anchorLatLng);\n    }\n\n    let edgeMinWidth = overlay.edgeMinWidth;\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n\n    const corner1 = map.latLngToContainerPoint(overlay.getCorner(0));\n    const corner2 = map.latLngToContainerPoint(overlay.getCorner(1));\n    const w = Math.abs(corner1.x - corner2.x);\n    const h = Math.abs(corner1.y - corner2.y);\n    const distance = Math.sqrt(w * w + h * h);\n    if (distance > edgeMinWidth || scale > 1) {\n      overlay.scaleBy(scale, anchorLatLng);\n    } else {\n      overlay.scaleBy(1, anchorLatLng);\n    }\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.resizeRotateHandle = (overlay, idx, options) => {\n  return new L.ResizeRotateHandle(overlay, idx, options);\n};\n","L.RotateHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'rotate',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAklEQVR4AewaftIAAAHiSURBVMXBa3HbShgA0PMp/1sCCo8oCEpgTaCXgIXAJiDzyCJoAUTm4UVQAns1Y8+snWnTvJyeE16hkjDgDrfoNTMKcpC9UPiLSo8JyetkjEHxjPCMyoS199kFoz8Iv1HpMaN3qWDCHoegOKkkRwnJpRmroHgiPFEZ8IBekzEGxQtUEhKSS/fB7Ew4U+lxcGkVZG9QWWPSFAxBcdK59KApuA+yNwp2uEdx1GN25sZJZULSfAtm77SlbNjju6MvG75u+WHRWVR6rDVjMPsgwYyVZl3pLTpHkyYHOx8syMiayaJzlDTZ9YyaZNFVkiYH2ZUEBcVJJXVImuz6Js3Qofe59pq7DoOTILu+g+a288mCouk7/1iH4qTS+2QdDppbV1ZJmrnDXnPnc5UOs2Z0fUmTuyBr+krvSioJyUmQO0dZM7mepMkWnaNRkyrJB6uskTSjxY3Fll8bvmJwlDb83FJ8gMqAB80uyBY3Trb82PAfvjj6vuHnluIdKgMeNXOwctK5NKBoHitrb1RJeHRp5Ux4ojLg0aWMHGQvUOkxIWkKVsHsTPiNSo8HDC5lZIsgO6n0uMUdRvQuFQxB8UR4RmXC2vvsgtEfhL+o9JiQvE7GGBTPCK9QSUjoMWgKDthjDrIX+h/k0I7gth6N5gAAAABJRU5ErkJggg==',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n    const angle = this.calculateAngleDelta(formerLatLng, newLatLng);\n\n    /*\n     * running rotation logic even for an angle delta of 0\n     * prevents a small, occasional marker flicker\n     */\n    overlay.rotateBy(angle, 'rad');\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.rotateHandle = function(overlay, idx, options) {\n  return new L.RotateHandle(overlay, idx, options);\n};\n","L.ScaleHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'scale',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSI0NTkiIGhlaWdodD0iNDY0IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCA1MTIgNTEyIiB4bWw6c3BhY2U9InByZXNlcnZlIiBzdHlsZT0iIj48cmVjdCBpZD0iYmFja2dyb3VuZHJlY3QiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHg9IjAiIHk9IjAiIGZpbGw9Im5vbmUiIHN0cm9rZT0ibm9uZSIgY2xhc3M9IiIgc3R5bGU9IiIvPjxnIGNsYXNzPSJjdXJyZW50TGF5ZXIiIHN0eWxlPSIiPjx0aXRsZT5MYXllciAxPC90aXRsZT48cGF0aCBkPSJNNDU5LjA0OTE1OTUzMDQ3MTM0LDg2LjkyNjIzNDUxMjU1MDAyIFYwIGgtODUuNzE0NTczMzU2MzEyMDkgdjI3LjA0MzcxNzQwMzkwNDQ1MiBIODUuNzE0NTczMzU2MzEyMDMgVjAgSDAgdjg2LjkyNjIzNDUxMjU1MDAyIGgyNS43MTQzNzIwMDY4OTM2MjYgdjI4OS43NTQxMTUwNDE4MzM0IEgwIHY4Ni45MjYyMzQ1MTI1NTAwMiBoODUuNzE0NTczMzU2MzEyMDkgdi0yNy4wNDM3MTc0MDM5MDQ0NTIgaDI4NS43MTUyNDQ1MjEwNDAzIHYyNy4wNDM3MTc0MDM5MDQ0NTIgaDg1LjcxNDU3MzM1NjMxMjA5IHYtODYuOTI2MjM0NTEyNTUwMDIgaC0yMy44MDk2MDM3MTAwODY2OSBWODYuOTI2MjM0NTEyNTUwMDIgSDQ1OS4wNDkxNTk1MzA0NzEzNCB6TTM4NC43NjMxOTU5NTUwMDA5LDEyLjU1NjAxMTY1MTgxMjc4MSBoNjEuOTA0OTY5NjQ2MjI1Mzk2IHY2Mi43ODAwNTgyNTkwNjM5MSBoLTYxLjkwNDk2OTY0NjIyNTM5NiBWMTIuNTU2MDExNjUxODEyNzgxIHpNMTIuMzgwOTkzOTI5MjQ1MDUsMTIuNTU2MDExNjUxODEyNzgxIGg2MS45MDQ5Njk2NDYyMjUzOTYgdjYyLjc4MDA1ODI1OTA2MzkxIEgxMi4zODA5OTM5MjkyNDUwNSBWMTIuNTU2MDExNjUxODEyNzgxIHpNNzQuMjg1OTYzNTc1NDcwNTMsNDUxLjA1MDU3MjQxNTEyMDY2IEgxMi4zODA5OTM5MjkyNDUwNSB2LTYyLjc4MDA1ODI1OTA2MzkxIGg2MS45MDQ5Njk2NDYyMjUzOTYgVjQ1MS4wNTA1NzI0MTUxMjA2NiB6TTQ0NS43MTU3ODE0NTI4MjI3NCw0NTEuMDUwNTcyNDE1MTIwNjYgaC02Mi44NTczNTM3OTQ2Mjg4NjQgdi02Mi43ODAwNTgyNTkwNjM5MSBoNjIuODU3MzUzNzk0NjI4ODY0IFY0NTEuMDUwNTcyNDE1MTIwNjYgek00MDcuNjIwNDE1NTE2Njg0MjYsMzc2LjY4MDM0OTU1NDM4MzQ0IGgtMzYuMTkwNTk3NjM5MzMxNzcgdjMyLjgzODc5OTcwNDc0MTEyIEg4NS43MTQ1NzMzNTYzMTIwMyB2LTMyLjgzODc5OTcwNDc0MTEyIEg0OS41MjM5NzU3MTY5ODAzMiBWODYuOTI2MjM0NTEyNTUwMDIgaDM2LjE5MDU5NzYzOTMzMTc3IFY1MC4yMjQwNDY2MDcyNTExMjUgaDI4Ny42MjAwMTI4MTc4NDcyIHYzNi43MDIxODc5MDUyOTg5IGgzNC4yODU4MjkzNDI1MjQ4MzUgVjM3Ni42ODAzNDk1NTQzODM0NCB6IiBpZD0ic3ZnXzIiIGNsYXNzPSIiIGZpbGw9IiMxYTFhZWIiIGZpbGwtb3BhY2l0eT0iMSIvPjwvZz48L3N2Zz4=',\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const map = overlay._map;\n    let edgeMinWidth = overlay.edgeMinWidth;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n    const scale = this._calculateScalingFactor(formerLatLng, newLatLng);\n\n    /*\n     * checks whether the \"edgeMinWidth\" property is set and tracks the minimum edge length;\n     * this enables preventing scaling to zero, but we might also add an overall scale limit\n     */\n\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n    const corner1 = map.latLngToLayerPoint(overlay.getCorner(0));\n    const corner2 = map.latLngToLayerPoint(overlay.getCorner(1));\n    const w = Math.abs(corner1.x - corner2.x);\n    const h = Math.abs(corner1.y - corner2.y);\n    const distance = Math.sqrt(w * w + h * h);\n\n    if (distance > edgeMinWidth || scale > 1) {\n      overlay.scaleBy(scale);\n      /*\n       * running scale logic even for a scale ratio of 1\n       * prevents a small, occasional marker flicker\n       */\n    } else {\n      overlay.scaleBy(1);\n    }\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.scaleHandle = function(overlay, idx, options) {\n  return new L.ScaleHandle(overlay, idx, options);\n};\n","L.TransformResizeHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'transformResize',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        `data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\">\n            <circle cx=\"16\" cy=\"16\" r=\"10\" stroke=\"white\" stroke-width=\"4\" fill=\"%23ffffff55\"/>\n            <circle cx=\"16\" cy=\"16\" r=\"10\" stroke=\"%232563eb\" stroke-width=\"2\" fill=\"none\"/>\n         </svg>`,\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const map = overlay._map;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const anchorLatLng = overlay.getOppositeCorner(this._corner);\n    const newLatLng = this.getLatLng();\n\n    const scale = this._calculateScalingFactor(formerLatLng, newLatLng, anchorLatLng);\n\n    let edgeMinWidth = overlay.edgeMinWidth;\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n\n    const corner1 = map.latLngToContainerPoint(overlay.getCorner(0));\n    const corner2 = map.latLngToContainerPoint(overlay.getCorner(1));\n    const w = Math.abs(corner1.x - corner2.x);\n    const h = Math.abs(corner1.y - corner2.y);\n    const distance = Math.sqrt(w * w + h * h);\n    if (distance > edgeMinWidth || scale > 1) {\n      overlay.scaleBy(scale, anchorLatLng);\n    } else {\n      overlay.scaleBy(1, anchorLatLng);\n    }\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.transformResizeHandle = (overlay, idx, options) => {\n  return new L.TransformResizeHandle(overlay, idx, options);\n};\n","/*  eslint-disable max-len */\nL.TransformRotateHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'transformRotate',\n    icon: L.icon({\n      iconUrl:\n        `data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n          <style type=\"text/css\">\n            .st0{ fill: %232563eb; }\n            .st1{ fill: white; }\n          </style>\n          <path class=\"st0\" d=\"M16,0L16,0c8.8,0,16,7.2,16,16l0,0c0,8.8-7.2,16-16,16l0,0C7.2,32,0,24.8,0,16l0,0C0,7.2,7.2,0,16,0z\"/>\n          <path class=\"st1\" d=\"M16,26.4c-2.9,0-5.4-1-7.4-3s-3-4.5-3-7.4c0-2.9,1-5.3,3-7.4c2-2,4.5-3,7.4-3c1.5,0,3,0.3,4.4,0.9\n            c1.4,0.6,2.6,1.5,3.5,2.7V6.9c0-0.3,0.1-0.6,0.4-0.9c0.2-0.2,0.5-0.4,0.9-0.4c0.3,0,0.6,0.1,0.9,0.4c0.2,0.2,0.4,0.5,0.4,0.9v6.5\n            c0,0.3-0.1,0.6-0.4,0.9s-0.5,0.4-0.9,0.4h-6.5c-0.3,0-0.6-0.1-0.9-0.4s-0.4-0.5-0.4-0.9c0-0.3,0.1-0.6,0.4-0.9\n            c0.2-0.2,0.5-0.4,0.9-0.4h4.2c-0.7-1.2-1.7-2.2-2.9-2.9c-1.2-0.7-2.5-1.1-4-1.1c-2.2,0-4.1,0.8-5.6,2.3C8.9,12,8.1,13.8,8.1,16\n            s0.8,4,2.3,5.6c1.5,1.5,3.4,2.3,5.6,2.3c1.5,0,2.9-0.4,4.1-1.1c1.2-0.8,2.2-1.8,2.9-3.1c0.2-0.3,0.4-0.5,0.7-0.6\n            c0.3-0.1,0.6-0.1,0.9,0c0.3,0.1,0.6,0.3,0.7,0.6c0.1,0.3,0.1,0.6,0,0.9c-0.9,1.7-2.1,3.1-3.8,4.2C19.9,25.8,18,26.4,16,26.4z\"/>\n        </svg>`,\n      iconSize: [24, 24],\n      iconAnchor: [12, 12],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const newLatLng = this.getLatLng();\n    const angle = this.calculateAngleDelta(formerLatLng, newLatLng);\n    overlay.rotateBy(angle, 'rad');\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.transformRotateHandle = function(overlay, idx, options) {\n  return new L.TransformRotateHandle(overlay, idx, options);\n};\n","L.TransformSquishHandle = L.EditHandle.extend({\n  options: {\n    TYPE: 'transformSquish',\n    icon: L.icon({\n      iconUrl:\n        // eslint-disable-next-line max-len\n        `data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\">\n            <circle cx=\"16\" cy=\"16\" r=\"6\" stroke=\"white\" stroke-width=\"4\" fill=\"%23ffffff55\"/>\n            <circle cx=\"16\" cy=\"16\" r=\"6\" stroke=\"%232563eb\" stroke-width=\"2\" fill=\"none\"/>\n         </svg>`,\n      iconSize: [32, 32],\n      iconAnchor: [16, 16],\n    }),\n  },\n\n  _onHandleDrag() {\n    const overlay = this._handled;\n    const map = overlay._map;\n    const formerLatLng = overlay.getCorner(this._corner);\n    const anchorLatLng = overlay.getOppositeCorner(this._corner);\n    const newLatLng = this.getLatLng();\n\n    const scale = this._calculateScalingFactor(formerLatLng, newLatLng, anchorLatLng);\n    const anchorCorners = this._corner === -1 ? [2, 3] :\n      this._corner === -2 ? [0, 1] :\n      this._corner === -3 ? [0, 2] :\n      [1, 3];\n\n    let edgeMinWidth = overlay.edgeMinWidth;\n    if (!edgeMinWidth) { edgeMinWidth = 50; } /* just in case */\n\n    const corner1 = map.latLngToContainerPoint(overlay.getCorner(0));\n    const corner2 = map.latLngToContainerPoint(overlay.getCorner(1));\n    const w = Math.abs(corner1.x - corner2.x);\n    const h = Math.abs(corner1.y - corner2.y);\n    const distance = Math.sqrt(w * w + h * h);\n    if (distance > edgeMinWidth || scale > 1) {\n      this.squishBy(scale, anchorCorners);\n    } else {\n      this.squishBy(1, anchorCorners);\n    }\n  },\n\n  squishBy(scale, anchorCorners) {\n    if (scale === 0) { return; }\n\n    const overlay = this._handled;\n    const map = overlay._map;\n    const scaledCorners = {};\n\n    for (let i = 0; i < 4; i++) {\n      if (anchorCorners.includes(i)) {\n        scaledCorners[i] = overlay.getCorner(i);\n        continue;\n      }\n\n      const oppositeCorners = i === 0 ? [1, 2] : i === 1 ? [0, 3] : i === 2 ? [0, 3] : [1, 2];\n      const anchor = map.project(overlay.getCorner(oppositeCorners.filter(x => anchorCorners.includes(x))[0]));\n      const p = map\n          .project(overlay.getCorner(i))\n          .subtract(anchor)\n          .multiplyBy(scale)\n          .add(anchor);\n      scaledCorners[i] = map.unproject(p);\n    }\n\n    overlay.setCorners(scaledCorners);\n  },\n\n  updateHandle() {\n    this.setLatLng(this._handled.getCorner(this._corner));\n  },\n});\n\nL.transformSquishHandle = (overlay, idx, options) => {\n  return new L.TransformSquishHandle(overlay, idx, options);\n};\n","L.distortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.group_action_map = {};\n\nL.DistortableImage.ControlBar = L.Toolbar2.Control.extend({});\n\nL.distortableImage.controlBar = function(options) {\n  return new L.DistortableImage.ControlBar(options);\n};\n\n/** addInitHooks run before onAdd */\nL.DistortableCollection.addInitHook(function() {\n  /** Default actions */\n  this.ACTIONS = [\n    L.ExportAction,\n    L.DeleteAction,\n    L.LockAction,\n    L.UnlockAction,\n  ];\n\n  // all possible modes\n  L.DistortableCollection.Edit.MODES = {\n    lock: L.LockAction,\n    unlock: L.UnlockAction,\n  };\n\n  const a = this.options.actions ? this.options.actions : this.ACTIONS;\n\n  this.editing = L.distortableCollection.edit(this, {actions: a});\n});\n","L.DistortableImage = L.DistortableImage || {};\nL.distortableImage = L.DistortableImage;\n\nL.DistortableImage.action_map = {};\n\nL.DistortableImage.PopupBar = L.Toolbar2.Popup.extend({\n  options: {\n    anchor: [0, -10],\n  },\n\n  initialize(latlng, options) {\n    L.setOptions(this, options);\n    L.Toolbar2.Popup.prototype.initialize.call(this, latlng, options);\n  },\n\n  addHooks(map, ov) {\n    this.map = map;\n    this.ov = ov;\n  },\n\n  tools() {\n    if (this._ul) {\n      return this._ul.children;\n    }\n  },\n\n  clickTool(name) {\n    const tools = this.tools();\n    for (let i = 0; i < tools.length; i++) {\n      const tool = tools.item(i).children[0];\n      if (L.DomUtil.hasClass(tool, name)) {\n        tool.click();\n        return tool;\n      }\n    }\n    return false;\n  },\n});\n\nL.distortableImage.popupBar = function(latlng, options) {\n  return new L.DistortableImage.PopupBar(latlng, options);\n};\n\nL.DistortableImageOverlay.addInitHook(function() {\n  /** Default actions */\n  this.ACTIONS = [\n    L.DragAction,\n    L.ScaleAction,\n    L.DistortAction,\n    L.RotateAction,\n    L.FreeRotateAction,\n    L.ResizeRotateAction,\n    L.TransformAction,\n    L.LockAction,\n    L.OpacityAction,\n    L.OpacitiesAction,\n    L.BorderAction,\n    L.ExportAction,\n    L.DeleteAction,\n  ];\n\n  // all possible modes\n  L.DistortableImage.Edit.MODES = {\n    drag: L.DragAction,\n    scale: L.ScaleAction,\n    distort: L.DistortAction,\n    rotate: L.RotateAction,\n    freeRotate: L.FreeRotateAction,\n    resizeRotate: L.ResizeRotateAction,\n    transform: L.TransformAction,\n    lock: L.LockAction,\n  };\n\n  const a = this.options.actions ? this.options.actions : this.ACTIONS;\n\n  this.editing = L.distortableImage.edit(this, {actions: a});\n});\n","/* this is the baseclass other IconSets inherit from,\n* we don't use it directly */\nL.IconSet = L.Class.extend({\n\n  _svg: '<svg xmlns=\"http://www.w3.org/2000/svg\">',\n\n  _symbols: '',\n\n  render() {\n    this.addSymbols(this._symbols);\n    return this._svg;\n  },\n\n  addSymbols(symbols) {\n    this._svg += symbols;\n  },\n});\n","L.KeymapperIconSet = L.IconSet.extend({\n\n  _symbols:\n      // eslint-disable-next-line max-len\n      '<symbol viewBox=\"0 0 25 25\" id=\"keyboard_open\"><path d=\"M12 23l4-4H8l4 4zm7-15h-2V6h2v2zm0 3h-2V9h2v2zm-3-3h-2V6h2v2zm0 3h-2V9h2v2zm0 4H8v-2h8v2zM7 8H5V6h2v2zm0 3H5V9h2v2zm1-2h2v2H8V9zm0-3h2v2H8V6zm3 3h2v2h-2V9zm0-3h2v2h-2V6zm9-3H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z\"/></symbol>',\n\n});\n","/* eslint-disable max-len */\nL.ToolbarIconSet = L.IconSet.extend({\n  _symbols:\n    '<symbol viewBox=\"0 0 18 18\" id=\"border_clear\"><path d=\"M5.25 3.75h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm3-3h1.5v-1.5h-1.5v1.5zm0 3h1.5v-1.5h-1.5v1.5zm-6 0h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm6 6h1.5v-1.5h-1.5v1.5zm6 3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0 6h1.5v-1.5h-1.5v1.5zm0-9h1.5v-1.5h-1.5v1.5zm-6 0h1.5v-1.5h-1.5v1.5zm6-4.5v1.5h1.5v-1.5h-1.5zm-6 1.5h1.5v-1.5h-1.5v1.5zm3 12h1.5v-1.5h-1.5v1.5zm0-6h1.5v-1.5h-1.5v1.5zm0-6h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"border_outer\"><path d=\"M9.75 5.25h-1.5v1.5h1.5v-1.5zm0 3h-1.5v1.5h1.5v-1.5zm3 0h-1.5v1.5h1.5v-1.5zm-10.5-6v13.5h13.5V2.25H2.25zm12 12H3.75V3.75h10.5v10.5zm-4.5-3h-1.5v1.5h1.5v-1.5zm-3-3h-1.5v1.5h1.5v-1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"cancel\"><path d=\"M13.279 5.779l-1.058-1.058L9 7.942 5.779 4.721 4.721 5.779 7.942 9l-3.221 3.221 1.058 1.058L9 10.057l3.221 3.222 1.058-1.058L10.057 9z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"crop_rotate\"><path d=\"M5.603 16.117C3.15 14.947 1.394 12.57 1.125 9.75H0C.383 14.37 4.245 18 8.963 18c.172 0 .33-.015.495-.023L6.6 15.113l-.997 1.005zM9.037 0c-.172 0-.33.015-.495.03L11.4 2.888l.998-.998a7.876 7.876 0 0 1 4.477 6.36H18C17.617 3.63 13.755 0 9.037 0zM12 10.5h1.5V6A1.5 1.5 0 0 0 12 4.5H7.5V6H12v4.5zM6 12V3H4.5v1.5H3V6h1.5v6A1.5 1.5 0 0 0 6 13.5h6V15h1.5v-1.5H15V12H6z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"delete_forever\"><path d=\"M4.5 14.25c0 .825.675 1.5 1.5 1.5h6c.825 0 1.5-.675 1.5-1.5v-9h-9v9zm1.845-5.34l1.058-1.058L9 9.443l1.59-1.59 1.058 1.058-1.59 1.59 1.59 1.59-1.058 1.058L9 11.558l-1.59 1.59-1.058-1.058 1.59-1.59-1.597-1.59zM11.625 3l-.75-.75h-3.75l-.75.75H3.75v1.5h10.5V3h-2.625z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"distort\"><path d=\"M1.7 1.4H6v1.4h5.8V1.4h4.3v4.3h-1.4v5.8h1.4v4.4h-4.3v-1.5H6v1.5H1.7v-4.4h1.4V5.7H1.7V1.4zm10.1 4.3V4.3H6v1.4H4.6v5.8H6V13h5.8v-1.5h1.4V5.7h-1.4zM3.1 2.8v1.5h1.5V2.8H3.1zm10.1 0v1.5h1.5V2.8h-1.5zM3.1 13v1.4h1.5V13H3.1zm10.1 0v1.4h1.5V13h-1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"explore\"><path d=\"M9 1.5C4.86 1.5 1.5 4.86 1.5 9c0 4.14 3.36 7.5 7.5 7.5 4.14 0 7.5-3.36 7.5-7.5 0-4.14-3.36-7.5-7.5-7.5zM9 15c-3.308 0-6-2.693-6-6 0-3.308 2.692-6 6-6 3.307 0 6 2.692 6 6 0 3.307-2.693 6-6 6zm-4.125-1.875l5.633-2.617 2.617-5.633-5.633 2.617-2.617 5.633zM9 8.175c.457 0 .825.367.825.825A.823.823 0 0 1 9 9.825.823.823 0 0 1 8.175 9c0-.457.367-.825.825-.825z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"flip_to_back\"><path d=\"M6.75 5.25h-1.5v1.5h1.5v-1.5zm0 3h-1.5v1.5h1.5v-1.5zm0-6a1.5 1.5 0 0 0-1.5 1.5h1.5v-1.5zm3 9h-1.5v1.5h1.5v-1.5zm4.5-9v1.5h1.5c0-.825-.675-1.5-1.5-1.5zm-4.5 0h-1.5v1.5h1.5v-1.5zm-3 10.5v-1.5h-1.5a1.5 1.5 0 0 0 1.5 1.5zm7.5-3h1.5v-1.5h-1.5v1.5zm0-3h1.5v-1.5h-1.5v1.5zm0 6c.825 0 1.5-.675 1.5-1.5h-1.5v1.5zm-10.5-7.5h-1.5v9a1.5 1.5 0 0 0 1.5 1.5h9v-1.5h-9v-9zm7.5-1.5h1.5v-1.5h-1.5v1.5zm0 9h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"flip_to_front\"><path d=\"M2.25 9.75h1.5v-1.5h-1.5v1.5zm0 3h1.5v-1.5h-1.5v1.5zm1.5 3v-1.5h-1.5a1.5 1.5 0 0 0 1.5 1.5zm-1.5-9h1.5v-1.5h-1.5v1.5zm9 9h1.5v-1.5h-1.5v1.5zm3-13.5h-7.5a1.5 1.5 0 0 0-1.5 1.5v7.5a1.5 1.5 0 0 0 1.5 1.5h7.5c.825 0 1.5-.675 1.5-1.5v-7.5c0-.825-.675-1.5-1.5-1.5zm0 9h-7.5v-7.5h7.5v7.5zm-6 4.5h1.5v-1.5h-1.5v1.5zm-3 0h1.5v-1.5h-1.5v1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"get_app\"><path d=\"M14.662 6.95h-3.15v-4.5H6.787v4.5h-3.15L9.15 12.2l5.512-5.25zM3.637 13.7v1.5h11.025v-1.5H3.637z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"lock\"><path d=\"M13.5 6h-.75V4.5C12.75 2.43 11.07.75 9 .75 6.93.75 5.25 2.43 5.25 4.5V6H4.5C3.675 6 3 6.675 3 7.5V15c0 .825.675 1.5 1.5 1.5h9c.825 0 1.5-.675 1.5-1.5V7.5c0-.825-.675-1.5-1.5-1.5zM6.75 4.5A2.247 2.247 0 0 1 9 2.25a2.247 2.247 0 0 1 2.25 2.25V6h-4.5V4.5zM13.5 15h-9V7.5h9V15zM9 12.75c.825 0 1.5-.675 1.5-1.5s-.675-1.5-1.5-1.5-1.5.675-1.5 1.5.675 1.5 1.5 1.5z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"opacity\"><path d=\"M13.245 6L9 1.763 4.755 6A6.015 6.015 0 0 0 3 10.23c0 1.5.585 3.082 1.755 4.252a5.993 5.993 0 0 0 8.49 0A6.066 6.066 0 0 0 15 10.23c0-1.5-.585-3.06-1.755-4.23zM4.5 10.5c.008-1.5.465-2.453 1.32-3.3L9 3.952l3.18 3.285c.855.84 1.313 1.763 1.32 3.263h-9z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 14 18\" id=\"opacity_empty\"><path stroke=\"#0078A8\" stroke-width=\"1.7\" d=\"M10.708 6.25A5.113 5.113 0 0 1 12.2 9.846c0 1.275-.497 2.62-1.492 3.614a5.094 5.094 0 0 1-7.216 0A5.156 5.156 0 0 1 2 9.846c0-1.275.497-2.601 1.492-3.596L7.1 2.648l3.608 3.602zm0 0L7.1 2.648 3.492 6.25A5.113 5.113 0 0 0 2 9.846c0 1.275.497 2.62 1.492 3.614a5.094 5.094 0 0 0 7.216 0A5.156 5.156 0 0 0 12.2 9.846a5.113 5.113 0 0 0-1.492-3.596z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 14 18\" id=\"opacities\"><g fill=\"#0078a8\"><path d=\"m2.1 10.85c.2.98.68 1.89 1.39 2.61 0 0 .01.01.01.01.99.99 2.3 1.49 3.6 1.49h.01c1.3 0 2.6-.5 3.59-1.5.73-.73 1.19-1.66 1.39-2.61z\" opacity=\".75\"/><path d=\"m2 9.85c0 .34.04.68.1 1.01h9.99c.07-.34.11-.67.11-1.01 0-1.13-.4-2.21-1.08-3.09h-8.04c-.7.91-1.08 2.01-1.08 3.09z\" opacity=\".5\"/><path d=\"m3.08 6.75h8.03c-.13-.17-.26-.35-.41-.5l-3.6-3.6-3.61 3.6c-.15.16-.27.33-.41.5z\" opacity=\".25\"/></g><path d=\"m10.71 6.25c.95.96 1.49 2.25 1.49 3.6 0 1.27-.5 2.62-1.49 3.61-1.99 1.99-5.21 2-7.2.01 0 0-.01-.01-.01-.01-.96-.96-1.5-2.26-1.5-3.61 0-1.27.5-2.6 1.49-3.6l3.61-3.6z\" fill=\"none\" stroke=\"#0078a8\" stroke-width=\".1\"/><path d=\"m10.71 6.25c.95.96 1.49 2.25 1.49 3.6 0 1.27-.5 2.62-1.49 3.61-1.99 1.99-5.21 2-7.2.01 0 0-.01-.01-.01-.01-.96-.96-1.5-2.26-1.5-3.61 0-1.27.5-2.6 1.49-3.6l3.61-3.6z\" fill=\"none\" stroke=\"#0078a8\" stroke-width=\"1.7\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"restore\"><path d=\"M15.67 3.839a.295.295 0 0 0-.22.103l-5.116 3.249V4.179a.342.342 0 0 0-.193-.315.29.29 0 0 0-.338.078L3.806 7.751v-4.63h-.002l.002-.022c0-.277-.204-.502-.456-.502h-.873V2.6c-.253 0-.457.225-.457.503l.002.026v10.883h.005c.021.257.217.454.452.455l.016-.002h.822c.013.001.025.004.038.004.252 0 .457-.225.457-.502a.505.505 0 0 0-.006-.068V9.318l6.001 3.811a.288.288 0 0 0 .332.074.34.34 0 0 0 .194-.306V9.878l5.12 3.252a.288.288 0 0 0 .332.073.34.34 0 0 0 .194-.306V4.18a.358.358 0 0 0-.09-.24.296.296 0 0 0-.218-.1z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"rotate\"><path d=\"M5.505 4.808L.645 9.675l4.867 4.86 4.868-4.86-4.875-4.868zM2.768 9.675L5.513 6.93 8.25 9.675 5.505 12.42 2.768 9.675zM14.52 4.98A6.713 6.713 0 009.75 3V.57L6.57 3.75l3.18 3.18V4.5a5.23 5.23 0 013.713 1.537 5.255 5.255 0 010 7.426 5.23 5.23 0 01-5.843 1.08L6.503 15.66a6.76 6.76 0 003.247.84c1.725 0 3.457-.66 4.77-1.98a6.735 6.735 0 000-9.54z\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"scale\"><path d=\"M8.25 9h-6a.75.75 0 00-.75.75v6c0 .414.336.75.75.75h6a.75.75 0 00.75-.75v-6A.75.75 0 008.25 9zm-.75 6H3v-4.5h4.5V15zm8.94-13.035a.75.75 0 00-.405-.405.75.75 0 00-.285-.06h-4.5a.75.75 0 000 1.5h2.692L9.967 6.968a.75.75 0 000 1.064.75.75 0 001.065 0L15 4.057V6.75a.75.75 0 101.5 0v-4.5a.75.75 0 00-.06-.285z\" /></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"spinner\"><path d=\"M9 6.48c-.216 0-.36-.144-.36-.36V3.24c0-.216.144-.36.36-.36s.36.144.36.36v2.88c0 .216-.144.36-.36.36z\"/><path d=\"M9 15.12c-.216 0-.36-.144-.36-.36v-2.88c0-.216.144-.36.36-.36s.36.144.36.36v2.88c0 .216-.144.36-.36.36zm1.44-8.28c-.072 0-.108 0-.18-.036-.144-.108-.216-.288-.108-.468l1.44-2.484c.108-.144.288-.216.468-.108.144.108.216.288.108.468l-1.44 2.484c-.072.072-.18.144-.288.144zm-4.32 7.488c-.072 0-.108 0-.18-.036-.144-.108-.216-.288-.108-.468l1.44-2.484c.108-.144.288-.216.468-.108.144.108.216.288.108.468l-1.44 2.484c-.072.072-.18.144-.288.144z\" opacity=\".3\"/><path d=\"M7.56 6.84c-.108 0-.216-.072-.288-.18l-1.44-2.484c-.108-.144-.036-.36.108-.468.144-.108.36-.036.468.108L7.848 6.3c.108.144.036.36-.108.468-.072.072-.108.072-.18.072z\" opacity=\".93\"/><path d=\"M11.88 14.328c-.108 0-.216-.072-.288-.18l-1.44-2.484c-.108-.144-.036-.36.108-.468.144-.108.36-.036.468.108l1.44 2.484c.108.144.036.36-.108.468-.072.036-.108.072-.18.072z\" opacity=\".3\"/><path d=\"M6.12 9.36H3.24c-.216 0-.36-.144-.36-.36s.144-.36.36-.36h2.88c.216 0 .36.144.36.36s-.144.36-.36.36z\" opacity=\".65\"/><path d=\"M14.76 9.36h-2.88c-.216 0-.36-.144-.36-.36s.144-.36.36-.36h2.88c.216 0 .36.144.36.36s-.144.36-.36.36z\" opacity=\".3\"/><path d=\"M6.516 7.884c-.072 0-.108 0-.18-.036l-2.484-1.44c-.144-.108-.216-.288-.108-.468.108-.144.288-.216.468-.108l2.484 1.44c.144.108.216.288.108.468a.327.327 0 01-.288.144z\" opacity=\".86\"/><path d=\"M14.004 12.204c-.072 0-.108 0-.18-.036l-2.484-1.44c-.144-.108-.216-.288-.108-.468.108-.144.288-.216.468-.108l2.484 1.44c.144.108.216.288.108.468a.327.327 0 01-.288.144z\" opacity=\".3\"/><path d=\"M3.996 12.204c-.108 0-.216-.072-.288-.18-.108-.144-.036-.36.108-.468l2.484-1.44c.144-.108.36-.036.468.108.108.144.036.36-.108.468l-2.484 1.44c-.036.072-.108.072-.18.072z\" opacity=\".44\"/><path d=\"M11.484 7.884c-.108 0-.216-.072-.288-.18-.108-.144-.036-.36.108-.468l2.484-1.44c.144-.108.36-.036.468.108.108.144.036.36-.108.468l-2.484 1.44c-.072.072-.108.072-.18.072z\" opacity=\".3\"/></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"drag\"><path d=\"M2.3 16.5c-0.2 0-0.4-0.1-0.5-0.2 -0.2-0.2-0.3-0.5-0.2-0.8l2.5-6.5 -2.5-6.5C1.5 2.3 1.5 2 1.7 1.8c0.2-0.2 0.5-0.3 0.8-0.2l6.5 2.5 6.5-2.5c0.3-0.1 0.6 0 0.8 0.2 0.2 0.2 0.3 0.5 0.2 0.8l-2.5 6.5 2.5 6.5c0.1 0.3 0 0.6-0.2 0.8 -0.2 0.2-0.5 0.3-0.8 0.2l-6.5-2.5 -6.5 2.5C2.4 16.5 2.3 16.5 2.3 16.5zM3.6 3.6l2 5.1c0.1 0.2 0.1 0.4 0 0.5l-2 5.1 5.1-2c0.2-0.1 0.4-0.1 0.5 0l5.1 2L12.4 9.3c-0.1-0.2-0.1-0.4 0-0.5l2-5.1L9.3 5.6c-0.2 0.1-0.4 0.1-0.5 0L3.6 3.6z\" /></symbol>' +\n    '<symbol viewBox=\"0 0 18 18\" id=\"unlock\"><path d=\"M13.5 6h-.75V4.5C12.75 2.43 11.07.75 9 .75 6.93.75 5.25 2.43 5.25 4.5h1.5A2.247 2.247 0 0 1 9 2.25a2.247 2.247 0 0 1 2.25 2.25V6H4.5C3.675 6 3 6.675 3 7.5V15c0 .825.675 1.5 1.5 1.5h9c.825 0 1.5-.675 1.5-1.5V7.5c0-.825-.675-1.5-1.5-1.5zm0 9h-9V7.5h9V15zM9 12.75c.825 0 1.5-.675 1.5-1.5s-.675-1.5-1.5-1.5-1.5.675-1.5 1.5.675 1.5 1.5 1.5z\"/></symbol>',\n});\n","L.Map.mergeOptions({\n  boxCollector: true,\n  boxZoom: false,\n});\n\n/**\n * primarily Leaflet 1.5.1 source code. Overriden so that it's a collection box used with\n * our `L.DistortableCollection` class instead of a zoom box.\n * */\nL.Map.BoxCollector = L.Map.BoxZoom.extend({\n  initialize(map) {\n    this._map = map;\n    this._container = map._container;\n    this._pane = map._panes.overlayPane;\n    this._resetStateTimeout = 0;\n    map.on('unload', this._destroy, this);\n  },\n\n  addHooks() {\n    L.DomEvent.on(this._container, 'mousedown', this._onMouseDown, this);\n  },\n\n  removeHooks() {\n    L.DomEvent.off(this._container, 'mousedown', this._onMouseDown, this);\n  },\n\n  moved() {\n    return this._moved;\n  },\n\n  _destroy() {\n    L.DomUtil.remove(this._pane);\n    delete this._pane;\n  },\n\n  _resetState() {\n    this._resetStateTimeout = 0;\n    this._moved = false;\n  },\n\n  _clearDeferredResetState() {\n    if (this._resetStateTimeout !== 0) {\n      clearTimeout(this._resetStateTimeout);\n      this._resetStateTimeout = 0;\n    }\n  },\n\n  _onMouseDown(e) {\n    if (!e.shiftKey || (e.which !== 1 && e.button !== 1)) {\n      return false;\n    }\n\n    // Clear the deferred resetState if it hasn't executed yet, otherwise it\n    // will interrupt the interaction and orphan a box element in the container.\n    this._clearDeferredResetState();\n    this._resetState();\n\n    L.DomUtil.disableTextSelection();\n    L.DomUtil.disableImageDrag();\n\n    this._startPoint = this._map.mouseEventToContainerPoint(e);\n\n    L.DomEvent.on(document, {\n      contextmenu: L.DomEvent.stop,\n      mousemove: this._onMouseMove,\n      mouseup: this._onMouseUp,\n    }, this);\n  },\n\n  _onMouseMove(e) {\n    if (!this._moved) {\n      this._moved = true;\n\n      this._box = L.DomUtil.create('div', 'leaflet-zoom-box', this._container);\n      L.DomUtil.addClass(this._container, 'leaflet-crosshair');\n\n      this._map.fire('boxzoomstart');\n    }\n\n    this._point = this._map.mouseEventToContainerPoint(e);\n\n    this._bounds = L.bounds(this._startPoint, this._point);\n    const size = this._bounds.getSize();\n\n    L.DomUtil.setPosition(this._box, this._bounds.min);\n\n    this._box.style.width = size.x + 'px';\n    this._box.style.height = size.y + 'px';\n  },\n\n  _finish() {\n    if (this._moved) {\n      L.DomUtil.remove(this._box);\n      L.DomUtil.removeClass(this._container, 'leaflet-crosshair');\n    }\n\n    L.DomUtil.enableTextSelection();\n    L.DomUtil.enableImageDrag();\n\n    L.DomEvent.off(document, {\n      contextmenu: L.DomEvent.stop,\n      mousemove: this._onMouseMove,\n      mouseup: this._onMouseUp,\n    }, this);\n  },\n\n  _onMouseUp(e) {\n    if (e.which !== 1 && e.button !== 1) {\n      return;\n    }\n\n    this._finish();\n\n    if (!this._moved) { return; }\n\n    // Postpone to next JS tick so internal click event handling\n    // still see it as \"moved\".\n    this._clearDeferredResetState();\n    this._resetStateTimeout = setTimeout(\n        L.Util.bind(this._resetState, this), 0);\n\n    let bounds = L.latLngBounds(\n        this._map.containerPointToLatLng(this._bounds.getBottomLeft()),\n        this._map.containerPointToLatLng(this._bounds.getTopRight())\n    );\n\n    const zoom = this._map.getZoom();\n    const center = this._map.getCenter();\n\n    // calls the `project` method but 1st updates the pixel origin - see https://github.com/publiclab/Leaflet.DistortableImage/pull/344\n    bounds = this._map._latLngBoundsToNewLayerBounds(bounds, zoom, center);\n\n    this._map.fire('boxcollectend', {boxCollectBounds: bounds});\n  },\n});\n\nL.Map.addInitHook('addHandler', 'boxCollector', L.Map.BoxCollector);\n","L.Map.mergeOptions({\n  doubleClickLabels: true,\n});\n\n/**\n * The `doubleClickLabels` handler replaces `doubleClickZoom` by default if `#addGoogleMutant`\n * is used unless the options 'labels: false' or 'doubleClickZoom: false` were passed to it.\n */\nL.Map.DoubleClickLabels = L.Map.DoubleClickZoom.extend({\n  enable() {\n    const map = this._map;\n\n    if (this._enabled) { return this; }\n\n    // disable 'doubleClickZoom' if 'doubleClickLabels' is enabled.\n    if (map.doubleClickZoom.enabled()) {\n      map.doubleClickZoom.disable();\n    }\n\n    this._map.fire('singleclickon');\n\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable() {\n    if (!this._enabled) { return this; }\n\n    this._enabled = false;\n    this.removeHooks();\n\n    return this;\n  },\n\n  _fireIfSingle(e) {\n    const map = this._map;\n    const oe = e.originalEvent;\n\n    // prevents deselection in case of box selector\n    if (oe && oe.shiftKey) { return; }\n\n    map._clicked += 1;\n    this._map._clickTimeout = setTimeout(function() {\n      if (map._clicked === 1) {\n        map._clicked = 0;\n        map.fire('singleclick', {type: 'singleclick'});\n      } else {\n        // manually fire doubleclick event only for touch screens that don't natively fire it\n        if (L.Browser.touch && (oe && oe.sourceCapabilities.firesTouchEvents)) {\n          map.fire('dblclick');\n        }\n      }\n    }, 250);\n  },\n\n  _onDoubleClick() {\n    const map = this._map;\n    const labels = map._labels;\n\n    setTimeout(function() {\n      map._clicked = 0;\n      clearTimeout(map._clickTimeout);\n    }, 0);\n\n    if (!labels) { return; }\n\n    if (labels.options.opacity === 1) {\n      labels.options.opacity = 0;\n      labels.setOpacity(0);\n    } else {\n      labels.options.opacity = 1;\n      labels.setOpacity(1);\n    }\n  },\n});\n\nL.Map.addInitHook('addHandler', 'doubleClickLabels', L.Map.DoubleClickLabels);\n","/**\n * `L.Map.DoubleClickZoom` from leaflet 1.5.1, overrwritten so that it\n * 1) Fires a `singleclick` event to avoid deselecting images on `dblclick`.\n * 2) Maintains a mutually exclusive relationship with the map's `DoubleClickLabels` handler\n */\nL.Map.DoubleClickZoom.include({\n  addHooks() {\n    this._map.on({\n      click: this._fireIfSingle,\n      dblclick: this._onDoubleClick,\n    }, this);\n  },\n\n  removeHooks() {\n    this._map.off({\n      click: this._fireIfSingle,\n      dblclick: this._onDoubleClick,\n    }, this);\n  },\n\n  enable() {\n    if (this._enabled) { return this; }\n\n    // don't enable 'doubleClickZoom' unless 'doubleClickLabels' is disabled first\n    if (this._map.doubleClickLabels) {\n      if (this._map.doubleClickLabels.enabled()) {\n        return this;\n      }\n    }\n\n    // signify to collection/instance classes to turn on 'singleclick' listeners\n    this._map.fire('singleclickon');\n\n    this._enabled = true;\n    this.addHooks();\n    return this;\n  },\n\n  disable() {\n    if (!this._enabled) { return this; }\n\n    // signify to collection/instance safe to swap 'singleclick' listeners with 'click' listeners.\n    this._map.fire('singleclickoff');\n\n    this._enabled = false;\n    this.removeHooks();\n    return this;\n  },\n\n  _fireIfSingle(e) {\n    const map = this._map;\n    const oe = e.originalEvent;\n\n    // prevents deselection in case of box selector\n    if (oe && oe.shiftKey) { return; }\n\n    map._clicked += 1;\n    this._map._clickTimeout = setTimeout(function() {\n      if (map._clicked === 1) {\n        map._clicked = 0;\n        map.fire('singleclick', {type: 'singleclick'});\n      } else {\n        // manually fire doubleclick event only for touch screens that don't natively fire it\n        // Add null safety checks to prevent errors when accessing nested properties\n        if (L.Browser.touch && oe && oe.sourceCapabilities && oe.sourceCapabilities.firesTouchEvents) {\n          /*  in `DoubleClickLabels.js`, we just do map.fire('dblclick') bc `_onDoublClick` doesn't use the\n          passed \"e\" (for now). To generate a 'real' DOM event that will have all of its corresponding core\n          properties (originalEvent, latlng, etc.), use Leaflet's `#map._fireDOMEvent` (Leaflet 1.5.1 source) */\n          // Additional check: ensure map has _fireDOMEvent method before calling\n          if (map._fireDOMEvent && typeof map._fireDOMEvent === 'function') {\n            try {\n              map._fireDOMEvent(oe, 'dblclick', [map]);\n            } catch (error) {\n              // Silently handle errors to prevent crashes during state transitions\n              if (console && console.warn) {\n                console.warn('Failed to fire DOM event:', error);\n              }\n            }\n          }\n        }\n      }\n    }, 250);\n  },\n\n  _onDoubleClick(e) {\n    const map = this._map;\n    const oe = e.originalEvent;\n\n    setTimeout(function() {\n      map._clicked = 0;\n      clearTimeout(map._clickTimeout);\n    }, 0);\n\n    if (!oe) { return false; }\n\n    const oldZoom = map.getZoom();\n    const delta = map.options.zoomDelta;\n    const zoom = oe.shiftKey ? oldZoom - delta : oldZoom + delta;\n\n    if (map.options.doubleClickZoom === 'center') {\n      map.setZoom(zoom);\n    } else {\n      map.setZoomAround(e.containerPoint, zoom);\n    }\n  },\n});\n","/* eslint-disable max-len */\nL.Map.include({\n\n  _clicked: 0,\n\n  addGoogleMutant(opts) {\n    const url = 'http://mt0.google.com/vt/lyrs=s&x={x}&y={y}&z={z}';\n\n    opts = this.mutantOptions = L.extend({\n      mutantOpacity: 0.8,\n      maxZoom: 24,\n      maxNativeZoom: 20,\n      minZoom: 0,\n      labels: true,\n      labelOpacity: 1,\n      doubleClickLabels: true,\n    }, opts);\n\n    if (!opts.labels) {\n      this.mutantOptions = L.extend(this.mutantOptions, {\n        labelOpacity: opts.labels ? 1 : undefined,\n        doubleClickLabels: opts.labels ? true : undefined,\n      });\n    }\n\n    this._googleMutant = L.tileLayer(url, {\n      maxZoom: opts.maxZoom,\n      maxNativeZoom: opts.maxNativeZoom,\n      minZoom: opts.minZoom,\n      opacity: opts.mutantOpacity,\n    }).addTo(this);\n\n    if (opts.labels) { this._addLabels(opts); }\n    // shouldn't have this handler at all if there are no labels to toggle\n    else {\n      this.doubleClickLabels = undefined;\n    }\n\n    return this;\n  },\n\n  _addLabels(opts) {\n    const url = 'https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}{r}.{ext}';\n\n    if (opts.labelOpacity !== 0 && opts.labelOpacity !== 1) {\n      opts.labelOpacity = 1;\n    }\n\n    this._labels = L.tileLayer(url, {\n      attribution: 'Map tiles by <a href=\"http://stamen.com\">Stamen Design</a>, <a href=\"http://creativecommons.org/licenses/by/3.0\">CC BY 3.0</a> &mdash; Map data &copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n      subdomains: 'abcd',\n      interactive: false,\n      opacity: opts.labelOpacity,\n      maxZoom: opts.maxZoom,\n      maxNativeZoom: opts.maxNativeZoom,\n      minZoom: opts.minZoom,\n      ext: 'png',\n    }).addTo(this);\n\n    if (this.mutantOptions.doubleClickLabels) {\n      this.doubleClickLabels.enable();\n    }\n\n    return this;\n  },\n});\n// start off with doubleClickZoom enabled, doubleClickLabels can later be enabled instead\n// during initialization\nL.Map.addInitHook(function() {\n  this.doubleClickLabels.disable();\n  this.doubleClickZoom.enable();\n});\n","L.DomUtil = L.extend(L.DomUtil, {\n  initTranslation(obj) {\n    this.translation = obj;\n  },\n\n  getMatrixString(m) {\n    const is3d = L.Browser.webkit3d || L.Browser.gecko3d || L.Browser.ie3d;\n\n    /*\n     * Since matrix3d takes a 4*4 matrix, we add in an empty row and column,\n     * which act as the identity on the z-axis.\n     * See:\n     *     http://franklinta.com/2014/09/08/computing-css-matrix3d-transforms/\n     *     https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function#M.C3.B6bius'_homogeneous_coordinates_in_projective_geometry\n     */\n    const matrix = [\n      m[0], m[3], 0, m[6],\n      m[1], m[4], 0, m[7],\n      0, 0, 1, 0,\n      m[2], m[5], 0, m[8],\n    ];\n\n    const str = is3d ? 'matrix3d(' + matrix.join(',') + ')' : '';\n\n    if (!is3d) {\n      console\n          .log('Your browser must support 3D CSS transforms' +\n          'in order to use DistortableImageOverlay.');\n    }\n\n    return str;\n  },\n\n  toggleClass(el, className) {\n    const c = className;\n    return this.hasClass(el, c) ?\n      this.removeClass(el, c) : this.addClass(el, c);\n  },\n\n  confirmDelete() {\n    return window.confirm(this.translation.confirmImageDelete);\n  },\n\n  confirmDeletes(n) {\n    if (n === 1) { return this.confirmDelete(); }\n\n    const translation = this.translation.confirmImagesDeletes;\n    let warningMsg = '';\n\n    if (typeof translation === 'function') {\n      warningMsg = translation(n);\n    } else {\n      warningMsg = translation;\n    }\n\n    return window.confirm(warningMsg);\n  },\n});\n","L.IconUtil = {\n  /* creates an svg elemenet with built in accessibility properties\n   * and standardized classes for styling, takes in the fragment\n   * identifier (id) of the symbol to reference. note for symplicity\n   * we allow providing the icon target with or without the '#' prefix\n   */\n  create(ref) {\n    if (/^#/.test(ref)) {\n      ref = ref.replace(/^#/, '');\n    }\n\n    return (\n      '<svg class=\"ldi-icon ldi-' + ref + '\"role=\"img\" focusable=\"false\">' +\n      '<use xlink:href=\"#' + ref + '\"></use>' +\n      '</svg>'\n    );\n  },\n\n  addClassToSvg(container, loader) {\n    const svg = container.querySelector('svg');\n\n    if (svg) {\n      L.DomUtil.addClass(svg, loader);\n    }\n  },\n\n  // finds the use element and toggles its icon reference\n  toggleXlink(container, ref1, ref2) {\n    if (!/^#/.test(ref1)) {\n      ref1 = '#' + ref1;\n    }\n    if (!/^#/.test(ref2)) {\n      ref2 = '#' + ref2;\n    }\n\n    const use = container.querySelector('use');\n    if (use) {\n      const toggled = use.getAttribute('xlink:href') === ref1 ? ref2 : ref1;\n      use.setAttribute('xlink:href', toggled);\n      return toggled;\n    }\n    return false;\n  },\n\n  toggleTitle(container, title1, title2) {\n    const toggled = container.getAttribute('title') === title1 ? title2 : title1;\n\n    container.setAttribute('title', toggled);\n    if (container.hasAttribute('aria-label')) {\n      container.setAttribute('aria-label', toggled);\n    }\n    return toggled;\n  },\n};\n","L.ImageUtil = {\n\n  getCmPerPixel(overlay) {\n    const map = overlay._map;\n\n    const dist = map\n        .latLngToLayerPoint(overlay.getCorner(0))\n        .distanceTo(map.latLngToLayerPoint(overlay.getCorner(1)));\n\n    return (dist * 100) / overlay.getElement().width;\n  },\n};\n","L.MatrixUtil = {\n\n  // Compute the adjugate of m\n  adj(m) {\n    return [\n      m[4]*m[8]-m[5]*m[7], m[2]*m[7]-m[1]*m[8], m[1]*m[5]-m[2]*m[4],\n      m[5]*m[6]-m[3]*m[8], m[0]*m[8]-m[2]*m[6], m[2]*m[3]-m[0]*m[5],\n      m[3]*m[7]-m[4]*m[6], m[1]*m[6]-m[0]*m[7], m[0]*m[4]-m[1]*m[3],\n    ];\n  },\n\n  // multiply two 3*3 matrices\n  multmm(a, b) {\n    const c = [];\n    let i;\n\n    for (i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        let cij = 0;\n\n        for (let k = 0; k < 3; k++) {\n          cij += a[3*i + k]*b[3*k + j];\n        }\n\n        c[3*i + j] = cij;\n      }\n    }\n\n    return c;\n  },\n\n  // multiply a 3*3 matrix and a 3-vector\n  multmv(m, v) {\n    return [\n      m[0]*v[0] + m[1]*v[1] + m[2]*v[2],\n      m[3]*v[0] + m[4]*v[1] + m[5]*v[2],\n      m[6]*v[0] + m[7]*v[1] + m[8]*v[2],\n    ];\n  },\n\n  // multiply a scalar and a 3*3 matrix\n  multsm(s, m) {\n    const matrix = [];\n\n    for (let i = 0, l = m.length; i < l; i++) {\n      matrix.push(s*m[i]);\n    }\n\n    return matrix;\n  },\n\n  basisToPoints(x1, y1, x2, y2, x3, y3, x4, y4) {\n    const m = [\n      x1, x2, x3,\n      y1, y2, y3,\n      1, 1, 1,\n    ];\n    const v = L.MatrixUtil.multmv(L.MatrixUtil.adj(m), [x4, y4, 1]);\n\n    return L.MatrixUtil.multmm(m, [\n      v[0], 0, 0,\n      0, v[1], 0,\n      0, 0, v[2],\n    ]);\n  },\n\n  project(m, x, y) {\n    const v = L.MatrixUtil.multmv(m, [x, y, 1]);\n\n    return [v[0]/v[2], v[1]/v[2]];\n  },\n\n  general2DProjection(\n      x1s, y1s, x1d, y1d,\n      x2s, y2s, x2d, y2d,\n      x3s, y3s, x3d, y3d,\n      x4s, y4s, x4d, y4d\n  ) {\n    const s = L.MatrixUtil.basisToPoints(x1s, y1s, x2s, y2s, x3s, y3s, x4s, y4s);\n    const d = L.MatrixUtil.basisToPoints(x1d, y1d, x2d, y2d, x3d, y3d, x4d, y4d);\n    const m = L.MatrixUtil.multmm(d, L.MatrixUtil.adj(s));\n\n    // Normalize to the unique matrix with m[8] == 1.\n    // See: http://franklinta.com/2014/09/08/computing-css-matrix3d-transforms/\n\n    return L.MatrixUtil.multsm(1/m[8], m);\n  },\n};\n","L.TrigUtil = {\n\n  calcAngle(x, y, unit = 'deg') {\n    return unit === 'deg' ?\n        this.radiansToDegrees(Math.atan2(y, x)) :\n        Math.atan2(y, x);\n  },\n\n  radiansToDegrees(angle) {\n    return (angle * 180) / Math.PI;\n  },\n\n  degreesToRadians(angle) {\n    return (angle * Math.PI) / 180;\n  },\n};\n","L.Utils = {\n  initTranslation() {\n    const translation = {\n      deleteImage: 'Delete Image',\n      deleteImages: 'Delete Images',\n      distortImage: 'Distort Image',\n      dragImage: 'Drag Image',\n      exportImage: 'Export Image',\n      exportImages: 'Export Images',\n      removeBorder: 'Remove Border',\n      addBorder: 'Add Border',\n      freeRotateImage: 'Free rotate Image',\n      resizeRotateImage: 'Resize rotate Image',\n      transformImage: 'Transform Image',\n      geolocateImage: 'Geolocate Image',\n      lockMode: 'Lock Mode',\n      lockImages: 'Lock Images',\n      makeImageOpaque: 'Make Image Opaque',\n      makeImageTransparent: 'Make Image Transparent',\n      restoreImage: 'Restore Natural Image',\n      rotateImage: 'Rotate Image',\n      scaleImage: 'Scale Image',\n      stackToFront: 'Stack to Front',\n      stackToBack: 'Stack to Back',\n      unlockImages: 'Unlock Images',\n      confirmImageDelete:\n        'Are you sure? This image will be permanently deleted from the map.',\n      confirmImagesDeletes:\n        'Are you sure? These images will be permanently deleted from the map.',\n    };\n\n    if (!this.options.translation) {\n      this.options.translation = translation;\n    } else {\n      // If the translation for a word is not specified, fallback to English.\n      for (const key in translation) {\n        if (!this.options.translation.hasOwnProperty(key)) {\n          this.options.translation[key] = translation[key];\n        }\n      }\n    }\n\n    L.DomUtil.initTranslation(this.options.translation);\n  },\n\n  getNestedVal(obj, key, nestedKey) {\n    const dig = [key, nestedKey];\n    return dig.reduce(function(obj, k) {\n      return obj && obj[k];\n    }, obj);\n  },\n};\n","// startup\n// Load entry module and return exports\n__webpack_modules__[999]();\n__webpack_modules__[85]();\n__webpack_modules__[351]();\n__webpack_modules__[360]();\n__webpack_modules__[682]();\n__webpack_modules__[866]();\n__webpack_modules__[477]();\n__webpack_modules__[808]();\n__webpack_modules__[743]();\n__webpack_modules__[988]();\n__webpack_modules__[92]();\n__webpack_modules__[194]();\n__webpack_modules__[206]();\n__webpack_modules__[789]();\n__webpack_modules__[355]();\n__webpack_modules__[337]();\n__webpack_modules__[350]();\n__webpack_modules__[959]();\n__webpack_modules__[335]();\n__webpack_modules__[780]();\n__webpack_modules__[376]();\n__webpack_modules__[261]();\n__webpack_modules__[929]();\n__webpack_modules__[280]();\n__webpack_modules__[426]();\n__webpack_modules__[114]();\n__webpack_modules__[231]();\n__webpack_modules__[541]();\n__webpack_modules__[149]();\n__webpack_modules__[74]();\n__webpack_modules__[691]();\n__webpack_modules__[105]();\n__webpack_modules__[496]();\n__webpack_modules__[944]();\n__webpack_modules__[973]();\n__webpack_modules__[954]();\n__webpack_modules__[178]();\n__webpack_modules__[547]();\n__webpack_modules__[886]();\n__webpack_modules__[654]();\n__webpack_modules__[129]();\n__webpack_modules__[93]();\n__webpack_modules__[719]();\n__webpack_modules__[397]();\n__webpack_modules__[428]();\n// This entry module is referenced by other modules so it can't be inlined\n__webpack_modules__[782]();\n__webpack_modules__[752]();\n__webpack_modules__[998]();\n__webpack_modules__[291]();\nvar __webpack_exports__ = {};\n__webpack_modules__[131]();\n"],"names":["arr","L","DistortableCollection","FeatureGroup","extend","options","editable","exportOpts","exportStartUrl","statusUrl","exportUrl","initialize","setOptions","this","prototype","call","Utils","initTranslation","onAdd","map","_map","editing","enable","on","_addEvents","_removeEvents","onRemove","disable","off","e","layer","DomEvent","dragstart","_dragStartMultiple","drag","_dragMultiple","getElement","mousedown","_deselectOthers","contextmenu","_longPressMultiSelect","preventDefault","eachLayer","edit","target","enabled","DomUtil","toggleClass","anyCollected","deselect","_addToolbar","_removeToolbar","isCollected","overlay","hasClass","getLayers","some","bind","_toggleCollected","shiftKey","every","each","_leaflet_id","push","splice","indexOf","stopPropagation","i","_dragStartPoints","c","getCorner","latLngToLayerPoint","topLeft","delta","subtract","_updateCollectionFromPoints","_toRemove","filter","mode","_mode","_toMove","layersToMove","p","Transformation","x","y","forEach","movedPoints","transform","setCornersFromPoints","_getAvgCmPerPixel","imgs","reduce","sum","img","cm_per_pixel","length","fetchRemoteJson","url","index","imgCollectionProps","axios","get","response","data","hasOwnProperty","collection","avg_cm_per_pixel","console","log","recreateImagesFromJsonUrl","imageCollectionObj","generateExportJson","allImages","json","sections","_image","src","split","filename","zc","getCorners","corners","lat","lon","lng","images","id","width","height","tooltipText","getTooltipText","image_file_name","nodes","ImageUtil","getCmPerPixel","reverse","distortableCollection","DistortableImageOverlay","ImageOverlay","crossOrigin","edgeMinWidth","selected","interactive","deselectOnOutsideClick","dragBehavior","selectOnDrag","draggable","_selected","_url","rotation","_initImage","_reset","_corners","zoomAnimation","Browser","any3d","_animateZoom","element","complete","naturalWidth","onImageLoad","getPane","appendChild","_initImageDimensions","units","deg","setAngle","rad","eventParents","_eventParents","eP","Object","keys","_onMouseDown","_onClick","singleclickon","_singleClickListeners","singleclickoff","_resetClickListeners","singleclick","_singleClick","doubleClickZoom","doubleClickLabels","fire","activateTooltip","closeTooltip","select","deactivateTooltip","originalImageWidth","getStyle","originalImageHeight","aspectRatio","parseInt","imageHeight","imageWidth","center","project","getCenter","offset","point","divideBy","unproject","add","_initialDimensions","zoom","getZoom","setBounds","latLngBounds","type","_mouseDownPos","clientX","clientY","isSelected","_rebuildingToolbar","_hideMarkers","wasMouseMovement","Math","sqrt","pow","_wasDragged","_programmaticGrouping","_showMarkers","setCorner","corner","latlng","toolbar","DistortableImage","PopupBar","_updateToolbarPos","edited","_cornerExceedsMapLats","crs","CRS","Simple","exceedsTop","exceedsBottom","bindTooltip","direction","openTooltip","closeToolTip","unbindTooltip","setCorners","latlngObj","k","pointsObj","layerPointToLatLng","scaleBy","scale","anchor","scaledCorners","multiplyBy","getAngle","unit","matrix","style","TRANSFORM","slice","row0x","row0y","row1x","row1y","determinant","angle","TrigUtil","calcAngle","PI","round","radiansToDegrees","Util","formatNum","currentAngle","angleToRotateBy","rotateBy","q","degreesToRadians","cos","sin","dragBy","formerPoint","newPoint","transCorners","restore","equals","_getTranslateString","is3d","webkit3d","close","image","transformMatrix","_calculateProjectiveTransform","warp","getMatrixString","translation","_leaflet_pos","join","event","latLngToNewLayerPoint","_latLngToNewLayerPoint","pointA","pointB","half","atan","atan2","aCorner","abs","bCorner","latLng","getOppositeCorner","newOptions","oldOptions","_updateProperties","isTooltipOpen","hasMode","setMode","setActions","actions","_refreshHandlers","propagate","error","warn","agg","latLngToCartesian","j","w","offsetWidth","h","offsetHeight","_subtract","MatrixUtil","general2DProjection","distortableImageOverlay","Map","addInitHook","getContainer","addClass","distortableImage","Keymapper","Handler","position","addHooks","_keymapper","_container","_buildContainer","_scrollWrapper","_wrap","_toggler","_createButton","_setMapper","_toggleKeymapper","disableClickPropagation","disableScrollPropagation","removeHooks","remove","container","create","setAttribute","divider","toggler","innerHTML","IconUtil","wrap","display","button","control","insertAdjacentHTML","addTo","className","toggleTitle","_injectIconSet","document","querySelector","el","_iconset","KeymapperIconSet","render","_n","mobile","keymapper","Edit","keymap","group_action_map","group","_group","_exportOpts","Escape","editActions","runExporter","getNestedVal","startExport","_onKeyDown","_decollectAll","boxcollectend","_addCollections","_enabled","handlerName","key","oe","originalEvent","HTMLImageElement","removeClass","_unlockGroup","hasTool","UnlockAction","_unlock","_lockGroup","LockAction","_lock","box","boxCollectBounds","imgBounds","_latLngBoundsToNewLayerBounds","intersects","_removeGroup","DeleteAction","layersToRemove","n","confirmDeletes","removeLayer","cancelExport","customCollection","undefined","clearInterval","updateInterval","suppressToolbar","controlBar","value","action","addTool","baseClass","removeTool","item","idx","ExportAction","Promise","resolve","opts","frequency","updater","JSON","parse","status_url","match","status","jpg","alert","handleStatusRes","setInterval","req","Request","Date","now","method","fetch","then","res","ok","text","fetchStatusUrl","mergedOpts","form","FormData","append","stringify","reqOpts","body","opacity","outline","action_map","_overlay","_toggledImage","_transparent","_outlined","_opacity","bringToFront","_initModes","_initHandles","_appendHandlesandDragable","parentGroup","window","handle","_disableDragging","_handles","_modes","MODES","_dragHandles","layerGroup","addLayer","dragHandle","_scaleHandles","scaleHandle","_distortHandles","distortHandle","_rotateHandles","rotateHandle","_freeRotateHandles","freeRotateHandle","_resizeRotateHandles","resizeRotateHandle","_transformHandles","transformResizeHandle","transformSquishHandle","transformRotateHandle","_lockHandles","lockHandle","distort","rotate","freeRotate","resizeRotate","lock","ov","_updateHandle","currentHandle","setOpacity","dragging","isMode","_enableDragging","replaceTool","old","next","_nextOrNone","getModes","nextMode","Draggable","_shouldDragMap","_getDragBehavior","_updatePosition","_lastPos","_newPos","clone","panBy","animate","currentPoint","newActions","Array","isArray","wasSelected","oldMode","_dragMode","_scaleMode","_distortMode","_rotateMode","_freeRotateMode","_resizeRotateMode","_transformMode","_toggleLockMode","_toggleOpacity","OpacityAction","_refresh","_setOpacities","o","OpacitiesAction","_toggleBorder","BorderAction","_toggleOrder","_stackUp","_stackDown","_removeOverlay","confirmDelete","_getExport","downloadable","Image","onload","nw","ne","sw","se","warpWebGl","fullResolutionSrc","StackAction","bringToBack","_deselect","getMode","maxLat","raisedPoint","popupBar","setLatLng","newMode","clickTool","modesArray","stop","EditAction","use","tooltip","removeBorder","addBorder","toolbarIcon","svg","html","b","toggleXlink","_link","deleteImage","Backspace","deleteImages","DistortAction","distortImage","d","DragAction","dragImage","D","Toolbar2","Action","_createIcon","args","iconOptions","_icon","constructor","_enableAction","_addSubToolbar","createElement","ToolbarIconSet","parentElement","_disableAction","editAction","isExporting","mouseLeaveSkip","isHooksExecuted","exportImage","exportImages","exportTool","mouseEnterHandler","handleMouseEnter","mouseLeaveHandler","handleMouseLeave","resetState","detachMouseEventListeners","renderExportIcon","setTimeout","attachMouseEventListeners","renderDownloadIcon","addEventListener","removeEventListener","renderCancelIcon","firstChild","addClassToSvg","FreeRotateAction","freeRotateImage","f","GeolocateAction","geolocateImage","EXIF","getData","u","l","lockMode","lockImages","opacities","isNaN","OpacitiesToolbar2","appendToContainer","m","_calculateDepth","_ul","_disabledEvents","_getActionConstructor","_arguments","subToolbar","link","_hide","makeImageOpaque","makeImageTransparent","ResizeRotateAction","resizeRotateImage","RestoreAction","restoreImage","RotateAction","rotateImage","r","ScaleAction","scaleImage","s","stackToFront","stackToBack","a","TransformAction","transformImage","unlockImages","getAllTags","GPS","GPSLatitude","GPSLongitude","GPSLatitudeRef","GPSLongitudeRef","GPSImgDirectionRef","GPSImgDirection","numerator","denominator","Orientation","GPSAltitude","GPSAltitudeRef","DistortHandle","EditHandle","TYPE","icon","iconUrl","iconSize","iconAnchor","_onHandleDrag","_handled","_corner","getLatLng","updateHandle","DragHandle","formerLatLng","newLatLng","Marker","markerOptions","zIndexOffset","_bindListeners","_unbindListeners","_onHandleDragStart","_onHandleDragEnd","_fireEdit","dragend","_calculateScalingFactor","latlngA","latlngB","centerPoint","formerRadiusSquared","_d2","newRadiusSquared","dx","dy","calculateAngleDelta","initialAngle","newAngle","FreeRotateHandle","corner1","latLngToContainerPoint","corner2","LockHandle","_tooltipOn","mouseup","_tooltipOff","handlesArr","_timer","_timeout","clearTimeout","getTooltip","permanent","currentTarget","ResizeRotateHandle","anchorLatLng","RotateHandle","ScaleHandle","TransformResizeHandle","TransformRotateHandle","TransformSquishHandle","anchorCorners","squishBy","includes","oppositeCorners","ControlBar","Control","ACTIONS","unlock","Popup","tools","children","name","tool","click","IconSet","Class","_svg","_symbols","addSymbols","symbols","mergeOptions","boxCollector","boxZoom","BoxCollector","BoxZoom","_pane","_panes","overlayPane","_resetStateTimeout","_destroy","moved","_moved","_resetState","_clearDeferredResetState","which","disableTextSelection","disableImageDrag","_startPoint","mouseEventToContainerPoint","mousemove","_onMouseMove","_onMouseUp","_box","_point","_bounds","bounds","size","getSize","setPosition","min","_finish","enableTextSelection","enableImageDrag","containerPointToLatLng","getBottomLeft","getTopRight","DoubleClickLabels","DoubleClickZoom","_fireIfSingle","_clicked","_clickTimeout","touch","sourceCapabilities","firesTouchEvents","_onDoubleClick","labels","_labels","include","dblclick","_fireDOMEvent","oldZoom","zoomDelta","setZoom","setZoomAround","containerPoint","addGoogleMutant","mutantOptions","mutantOpacity","maxZoom","maxNativeZoom","minZoom","labelOpacity","_googleMutant","tileLayer","_addLabels","attribution","subdomains","ext","obj","gecko3d","ie3d","str","confirm","confirmImageDelete","warningMsg","confirmImagesDeletes","ref","test","replace","loader","ref1","ref2","toggled","getAttribute","title1","title2","hasAttribute","distanceTo","adj","multmm","cij","multmv","v","multsm","basisToPoints","x1","y1","x2","y2","x3","y3","x4","y4","x1s","y1s","x1d","y1d","x2s","y2s","x2d","y2d","x3s","y3s","x3d","y3d","x4s","y4s","x4d","y4d","nestedKey","__webpack_modules__"],"sourceRoot":""}